{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"curl | bash","text":""},{"location":"about/","title":"About this site","text":""},{"location":"blog/","title":"News","text":""},{"location":"blog/2026/01/frankenphpdevinstallsh/","title":"frankenphp.dev/install.sh","text":"<p>The FrankenPHP installer is a 154-line POSIX shell script that installs the FrankenPHP application server \u2014 a modern PHP app server built on Caddy \u2014 via <code>curl -sL https://frankenphp.dev/install.sh | bash</code>. It takes three different installation paths depending on what it finds: on Linux with dnf, it adds an RPM repository from <code>rpm.henderkes.com</code> and installs a native package with systemd integration; on Linux with apt, it does the equivalent via a DEB repository at <code>deb.henderkes.com</code>; and on all other systems (macOS, or Linux without apt/dnf), it downloads a static binary from GitHub releases directly into the current directory. The script uses <code>tput</code> for terminal formatting instead of raw ANSI codes, and on Linux it applies <code>setcap cap_net_bind_service</code> to let the binary bind ports 80/443 without root.</p>"},{"location":"blog/2026/01/frankenphpdevinstallsh/#script-info","title":"Script info","text":"URL <code>https://frankenphp.dev/install.sh</code> Invocation <code>curl -sL https://frankenphp.dev/install.sh \\| bash</code> Total lines 154 Comments 3 lines Blank 19 lines Boilerplate 9 lines (tput formatting variables, empty echo lines) Installation 122 lines (actual work)"},{"location":"blog/2026/01/frankenphpdevinstallsh/#what-does-it-change","title":"What does it change?","text":""},{"location":"blog/2026/01/frankenphpdevinstallsh/#files-and-folders","title":"Files and folders","text":"<p>Via package manager (Linux with dnf or apt):</p> <ul> <li>Installs the <code>frankenphp</code> binary to <code>/usr/bin/frankenphp</code></li> <li>Installs a systemd service that reads <code>/etc/frankenphp/Caddyfile</code></li> <li>PHP configuration at <code>/etc/php-zts/php.ini</code></li> </ul> <p>Via dnf:</p> <ul> <li>Adds the RPM repo package from <code>https://rpm.henderkes.com/static-php-1-0.noarch.rpm</code></li> </ul> <p>Via apt:</p> <ul> <li>Downloads GPG signing key to <code>/usr/share/keyrings/static-php.gpg</code></li> <li>Creates <code>/etc/apt/sources.list.d/static-php.list</code> pointing to <code>https://deb.henderkes.com/</code></li> </ul> <p>Via direct download (macOS or Linux without apt/dnf):</p> <ul> <li>Downloads a single static binary to <code>$BIN_DIR/frankenphp</code>, where <code>$BIN_DIR</code> defaults to the current working directory (<code>$(pwd)</code>)</li> <li>Marks the binary executable with <code>chmod +x</code></li> <li>On Linux with glibc, downloads the <code>-gnu</code> variant; on musl-based systems, downloads the standard variant</li> <li>Suggests moving the binary to <code>/usr/local/bin/</code> if it's not already in <code>$PATH</code></li> <li>Reads <code>/etc/frankenphp/php.ini</code> if it exists (no file is created)</li> </ul>"},{"location":"blog/2026/01/frankenphpdevinstallsh/#packages-installed","title":"Packages installed","text":"<p>On Linux with dnf (Fedora, RHEL, etc.):</p> <ul> <li><code>static-php-1-0.noarch.rpm</code> \u2014 the repository package from <code>rpm.henderkes.com</code></li> <li>Enables the <code>php-zts:static-8.4</code> module stream</li> <li><code>frankenphp</code> \u2014 the main package</li> </ul> <p>On Linux with apt (Debian, Ubuntu, etc.):</p> <ul> <li><code>frankenphp</code> \u2014 installed from the <code>deb.henderkes.com</code> repository</li> </ul>"},{"location":"blog/2026/01/frankenphpdevinstallsh/#downloads","title":"Downloads","text":"<ul> <li>dnf path: RPM repo package from <code>https://rpm.henderkes.com/static-php-1-0.noarch.rpm</code></li> <li>apt path: GPG key from <code>https://key.henderkes.com/static-php.gpg</code></li> <li>Direct download: Binary from <code>https://github.com/php/frankenphp/releases/latest/download/</code> \u2014 one of six variants:<ul> <li><code>frankenphp-linux-x86_64-gnu</code> (Linux x86_64, glibc)</li> <li><code>frankenphp-linux-x86_64</code> (Linux x86_64, musl)</li> <li><code>frankenphp-linux-aarch64-gnu</code> (Linux ARM64, glibc)</li> <li><code>frankenphp-linux-aarch64</code> (Linux ARM64, musl)</li> <li><code>frankenphp-mac-arm64</code> (macOS Apple Silicon)</li> <li><code>frankenphp-mac-x86_64</code> (macOS Intel)</li> </ul> </li> </ul>"},{"location":"blog/2026/01/frankenphpdevinstallsh/#permissions","title":"Permissions","text":"<ul> <li>Uses <code>sudo</code> when not running as root (detected via <code>id -u</code>)</li> <li>For the direct download path, does a writability check on <code>$DEST</code> via <code>touch</code> \u2014 if it fails, escalates to sudo for the download destination</li> <li>On Linux, applies <code>setcap 'cap_net_bind_service=+ep'</code> to the binary if <code>setcap</code> is available, allowing the binary to bind to ports 80 and 443 without running as root</li> </ul>"},{"location":"blog/2026/01/frankenphpdevinstallsh/#uninstall","title":"Uninstall","text":"<p>If installed via package manager:</p> <pre><code># dnf\nsudo dnf remove frankenphp\n\n# apt\nsudo apt remove frankenphp\nsudo rm /etc/apt/sources.list.d/static-php.list\nsudo rm /usr/share/keyrings/static-php.gpg\n</code></pre> <p>If installed via direct download:</p> <pre><code># Remove the binary (wherever BIN_DIR pointed, default is where you ran the script)\nrm ./frankenphp\n\n# Or if you moved it:\nsudo rm /usr/local/bin/frankenphp\n</code></pre> <p>Remove the optional configuration directory if created:</p> <pre><code>sudo rm -rf /etc/frankenphp\n</code></pre>"},{"location":"blog/2026/01/frankenphpdevinstallsh/#full-source","title":"Full source","text":"<p>The full script source is saved as <code>docs/scripts/frankenphp_dev_install_sh.txt</code>.</p>"},{"location":"blog/2026/01/getdockercom/","title":"get.docker.com","text":"<p>The Docker convenience install script at <code>get.docker.com</code> is a substantial 764-line shell script that configures Docker's official package repositories and installs Docker Engine, CLI, containerd, Compose, Buildx, rootless extras, and (as of v28.2) the Docker Model plugin on Linux systems via <code>curl -fsSL https://get.docker.com | bash</code>. It supports Debian/Ubuntu/Raspbian (apt), CentOS/Fedora/RHEL (dnf/yum), handles architecture detection, version pinning, channel selection (stable/test), and China mirror support (Aliyun, Azure). The entire script body is wrapped in a <code>do_install()</code> function as protection against partial downloads during pipe execution \u2014 a classic defensive pattern. Roughly 150 lines are comments, including a 97-line header that doubles as thorough usage documentation.</p>"},{"location":"blog/2026/01/getdockercom/#script-info","title":"Script info","text":"URL <code>https://get.docker.com</code> Invocation <code>curl -fsSL https://get.docker.com \\| bash</code> Total lines 764 Comments 150 lines (including 97-line header with usage docs) Blank 50 lines Boilerplate ~50 lines (deprecation notices, post-install info, version comparison helpers) Installation ~513 lines (actual work)"},{"location":"blog/2026/01/getdockercom/#what-does-it-change","title":"What does it change?","text":""},{"location":"blog/2026/01/getdockercom/#files-and-folders","title":"Files and folders","text":"<ul> <li>On Debian/Ubuntu/Raspbian: creates <code>/etc/apt/keyrings/</code> (mode 0755), downloads Docker's GPG key to <code>/etc/apt/keyrings/docker.asc</code>, and writes the apt source to <code>/etc/apt/sources.list.d/docker.list</code></li> <li>On CentOS/Fedora/RHEL: adds the Docker repo file to <code>/etc/yum.repos.d/</code> via <code>dnf config-manager</code> or <code>yum-config-manager</code>, replacing any existing <code>docker-ce.repo</code> or <code>docker-ce-staging.repo</code></li> </ul>"},{"location":"blog/2026/01/getdockercom/#packages-installed","title":"Packages installed","text":"<p>On Debian/Ubuntu/Raspbian (via apt):</p> <ul> <li><code>ca-certificates</code>, <code>curl</code> (prerequisites)</li> <li><code>docker-ce</code> (Docker Engine)</li> <li><code>docker-ce-cli</code> (CLI, for versions &gt;= 18.09)</li> <li><code>containerd.io</code> (container runtime, &gt;= 18.09)</li> <li><code>docker-compose-plugin</code> (Compose v2, &gt;= 20.10)</li> <li><code>docker-ce-rootless-extras</code> (rootless mode, &gt;= 20.10)</li> <li><code>docker-buildx-plugin</code> (BuildKit, &gt;= 23.0)</li> <li><code>docker-model-plugin</code> (AI model runner, &gt;= 28.2)</li> </ul> <p>On CentOS/Fedora/RHEL (via dnf or yum):</p> <ul> <li><code>dnf-plugins-core</code> or <code>yum-utils</code> (prerequisites)</li> <li>Same Docker packages as above, with version-appropriate RPM suffixes</li> </ul> <p>Version pinning is supported via <code>--version</code> \u2014 the script searches <code>apt-cache madison</code> or <code>dnf/yum list --showduplicates</code> to resolve the exact package version.</p>"},{"location":"blog/2026/01/getdockercom/#downloads","title":"Downloads","text":"<ul> <li>Docker GPG signing key: <code>https://download.docker.com/linux/&lt;distro&gt;/gpg</code> (Debian/Ubuntu/Raspbian only)</li> <li>Docker repo file: <code>https://download.docker.com/linux/&lt;distro&gt;/docker-ce.repo</code> (CentOS/Fedora/RHEL only)</li> <li>Optional mirrors: <code>https://mirrors.aliyun.com/docker-ce</code> (Aliyun) or <code>https://mirror.azure.cn/docker-ce</code> (Azure China)</li> </ul>"},{"location":"blog/2026/01/getdockercom/#services","title":"Services","text":"<ul> <li>Enables and starts <code>docker.service</code> via <code>systemctl enable --now</code> unless <code>--no-autostart</code> is passed</li> <li>In container environments without systemd, prints a notice that the daemon cannot be auto-started</li> </ul>"},{"location":"blog/2026/01/getdockercom/#permissions","title":"Permissions","text":"<ul> <li>Requires root or sudo/su \u2014 the script constructs a <code>sh_c</code> variable set to <code>sudo -E sh -c</code> (or <code>su -c</code>) and runs all system commands through it</li> <li>After installation, prints instructions for rootless mode (<code>dockerd-rootless-setuptool.sh install</code>) for versions &gt;= 20.10</li> </ul>"},{"location":"blog/2026/01/getdockercom/#system-configuration","title":"System configuration","text":"<ul> <li>Reads <code>/etc/os-release</code>, <code>/etc/lsb-release</code>, and <code>/etc/debian_version</code> to detect the distribution and version</li> <li>Handles forked distros (e.g., OSMC \u2192 Raspbian, unnamed Debian derivatives) via <code>lsb_release -a -u</code> and codename mapping (Debian 8\u201313 \u2192 jessie through trixie)</li> <li>Prints deprecation notices for EOL distributions: CentOS 7/8, RHEL 7, Debian stretch/buster/jessie, Ubuntu focal and older non-LTS releases, Fedora &lt; 41</li> <li>Detects WSL and recommends Docker Desktop for Windows instead</li> </ul>"},{"location":"blog/2026/01/getdockercom/#uninstall","title":"Uninstall","text":"<p>Remove the Docker packages with your package manager:</p> <pre><code># Debian/Ubuntu\nsudo apt-get purge docker-ce docker-ce-cli containerd.io docker-compose-plugin docker-buildx-plugin docker-ce-rootless-extras docker-model-plugin\nsudo apt-get autoremove\n\n# CentOS/Fedora/RHEL\nsudo dnf remove docker-ce docker-ce-cli containerd.io docker-compose-plugin docker-buildx-plugin docker-ce-rootless-extras docker-model-plugin\n</code></pre> <p>Remove Docker data and configuration:</p> <pre><code>sudo rm -rf /var/lib/docker\nsudo rm -rf /var/lib/containerd\n</code></pre> <p>Remove the repository configuration:</p> <pre><code># Debian/Ubuntu\nsudo rm /etc/apt/sources.list.d/docker.list\nsudo rm /etc/apt/keyrings/docker.asc\n\n# CentOS/Fedora/RHEL\nsudo rm /etc/yum.repos.d/docker-ce.repo\n</code></pre>"},{"location":"blog/2026/01/getdockercom/#full-source","title":"Full source","text":"<p>The full script source is saved as <code>docs/scripts/get_docker_com.txt</code>.</p>"},{"location":"blog/2026/01/laravelbuildexample-app/","title":"laravel.build/example-app","text":"<p>The <code>laravel.build</code> installer is a compact 52-line script generated server-side by Laravel's build service, invoked via <code>curl -sL https://laravel.build/example-app | bash</code>. The URL path (<code>example-app</code>) determines the project name, and query parameters can customize which services are included. The script requires Docker to be running, pulls the <code>laravelsail/php84-composer:latest</code> image, runs <code>laravel new</code> and <code>sail:install</code> inside a container, then uses Laravel Sail to pull and build Docker images for mysql, redis, meilisearch, mailpit, and selenium. No software is installed on the host beyond the project directory \u2014 everything runs in Docker. Notably, the script has no shebang line and supports <code>doas</code> as a sudo alternative alongside the usual <code>sudo</code>.</p>"},{"location":"blog/2026/01/laravelbuildexample-app/#script-info","title":"Script info","text":"URL <code>https://laravel.build/example-app</code> Invocation <code>curl -sL https://laravel.build/example-app \\| bash</code> Total lines 52 Comments 2 lines Blank 9 lines Boilerplate 10 lines (color variables, formatted echo output) Installation 31 lines (actual work)"},{"location":"blog/2026/01/laravelbuildexample-app/#what-does-it-change","title":"What does it change?","text":""},{"location":"blog/2026/01/laravelbuildexample-app/#files-and-folders","title":"Files and folders","text":"<ul> <li>Creates an <code>example-app/</code> directory in the current working directory, containing a full Laravel project with Sail configuration</li> <li>The project is scaffolded inside a Docker container (<code>laravelsail/php84-composer:latest</code>) with the current directory bind-mounted to <code>/opt</code>, so the files end up on the host</li> <li>Runs <code>chown -R $USER:</code> on the project directory to transfer ownership from root (Docker) to the current user</li> </ul>"},{"location":"blog/2026/01/laravelbuildexample-app/#downloads","title":"Downloads","text":"<ul> <li>Pulls the Docker image <code>laravelsail/php84-composer:latest</code> (with <code>--pull=always</code>, so it always fetches the newest version)</li> <li>Inside the container, <code>laravel new</code> downloads the Laravel framework and its Composer dependencies</li> <li><code>sail pull</code> downloads Docker images for the configured services: mysql, redis, meilisearch, mailpit, and selenium</li> <li><code>sail build</code> builds the application's Docker image</li> </ul> <p>The service list is server-side templated. The URL <code>https://laravel.build/example-app?with=mysql,redis</code> would generate a script with only mysql and redis. Passing <code>?with=none</code> skips the pull step and only runs <code>sail build</code>.</p>"},{"location":"blog/2026/01/laravelbuildexample-app/#services","title":"Services","text":"<ul> <li>No host-level services are installed or started \u2014 all services (MySQL, Redis, Meilisearch, Mailpit, Selenium) run as Docker containers managed by Laravel Sail</li> <li>After installation, the user starts everything with <code>./vendor/bin/sail up</code></li> </ul>"},{"location":"blog/2026/01/laravelbuildexample-app/#permissions","title":"Permissions","text":"<ul> <li>Uses <code>sudo</code> or <code>doas</code> (whichever is available, with <code>doas</code> checked first) to <code>chown -R</code> the project directory to the current user</li> <li>If the user's sudo/doas session is already active (<code>-n true</code> succeeds), it runs silently; otherwise it prompts for a password</li> </ul>"},{"location":"blog/2026/01/laravelbuildexample-app/#uninstall","title":"Uninstall","text":"<p>Remove the project directory:</p> <pre><code>cd example-app\n./vendor/bin/sail down --rmi all --volumes  # stop containers, remove images and volumes\ncd ..\nrm -rf example-app\n</code></pre> <p>Remove the pulled Docker images if no longer needed:</p> <pre><code>docker rmi laravelsail/php84-composer:latest\n# Plus any service images (mysql, redis, meilisearch, etc.)\ndocker image prune\n</code></pre> <p>No shell profile, PATH, or system configuration changes need to be reversed.</p>"},{"location":"blog/2026/01/laravelbuildexample-app/#full-source","title":"Full source","text":"<p>The full script source is saved as <code>docs/scripts/laravel_build_example_app.txt</code>.</p>"},{"location":"blog/2026/01/phpnewinstallmac/","title":"php.new/install/mac","text":"<p>The <code>php.new</code> macOS installer is a compact 212-line script that sets up a ready-to-go PHP development environment via <code>curl -sL https://php.new/install/mac | bash</code>. It downloads pre-built binaries for PHP 8.5, Composer, and the Laravel installer from <code>download.herdphp.com</code> \u2014 the infrastructure behind Laravel Herd \u2014 and drops them into <code>~/.config/herd-lite/bin/</code>. It also fetches the Mozilla CA certificate bundle from <code>curl.se</code>, creates a minimal <code>php.ini</code>, wires <code>PATH</code> and <code>PHP_INI_SCAN_DIR</code> into your shell profile, and generates its own uninstall script. The whole thing is essentially \"Herd Lite\": a standalone subset of Laravel Herd that skips the GUI and gives you three executables and a config directory.</p>"},{"location":"blog/2026/01/phpnewinstallmac/#script-info","title":"Script info","text":"URL <code>https://php.new/install/mac</code> Invocation <code>curl -sL https://php.new/install/mac \\| bash</code> Total lines 212 Comments 15 lines Blank 42 lines Boilerplate 6 lines (output formatting, colors) Installation 148 lines (actual work)"},{"location":"blog/2026/01/phpnewinstallmac/#what-does-it-change","title":"What does it change?","text":""},{"location":"blog/2026/01/phpnewinstallmac/#files-and-folders","title":"Files and folders","text":"<ul> <li>Creates <code>~/.config/herd-lite/bin/</code> and populates it with five files: <code>php</code>, <code>composer</code>, <code>laravel</code>, <code>cacert.pem</code>, and <code>php.ini</code></li> <li>Creates <code>~/.config/herd-lite/bin/uninstall_herd_lite</code> \u2014 a self-contained uninstall script that removes the entire <code>herd-lite</code> directory</li> <li>All downloaded binaries (<code>php</code>, <code>composer</code>, <code>laravel</code>, <code>uninstall_herd_lite</code>) are <code>chmod +x</code>'d after download</li> </ul>"},{"location":"blog/2026/01/phpnewinstallmac/#downloads","title":"Downloads","text":"<ul> <li>PHP binary: <code>https://download.herdphp.com/herd-lite/macos/arm64/8.5/php</code> (Apple Silicon) or <code>https://download.herdphp.com/herd-lite/macos/x64/8.5/php</code> (Intel) \u2014 selected via <code>uname -m</code></li> <li>Composer: <code>https://download.herdphp.com/herd-lite/composer</code></li> <li>Laravel installer: <code>https://download.herdphp.com/resources/laravel</code></li> <li>CA certificate bundle: <code>https://curl.se/ca/cacert.pem</code></li> </ul>"},{"location":"blog/2026/01/phpnewinstallmac/#environment-changes","title":"Environment changes","text":"<ul> <li>Appends <code>export PATH=\"~/.config/herd-lite/bin:$PATH\"</code> and <code>export PHP_INI_SCAN_DIR=\"~/.config/herd-lite/bin:$PHP_INI_SCAN_DIR\"</code> to the first matching shell profile file</li> <li>For bash: checks <code>~/.bashrc</code>, <code>~/.bash_profile</code>, <code>~/.profile</code> in order</li> <li>For zsh: checks <code>~/.zshrc</code>, <code>~/.zprofile</code>, <code>~/.profile</code> in order</li> <li>Skips the PATH update if <code>~/.config/herd-lite/bin</code> is already present in <code>$PATH</code></li> <li>Creates <code>php.ini</code> with three directives: <code>curl.cainfo</code> and <code>openssl.cafile</code> pointing to the downloaded <code>cacert.pem</code>, and <code>pcre.jit=0</code></li> </ul>"},{"location":"blog/2026/01/phpnewinstallmac/#permissions","title":"Permissions","text":"<ul> <li>The script checks for an existing Laravel Herd installation at <code>~/Library/Application Support/Herd/bin/php</code> and prompts for confirmation before proceeding</li> <li>No <code>sudo</code> is used \u2014 everything installs into the user's home directory</li> </ul>"},{"location":"blog/2026/01/phpnewinstallmac/#uninstall","title":"Uninstall","text":"<p>The script generates its own uninstall script. Run it:</p> <pre><code>~/.config/herd-lite/bin/uninstall_herd_lite\n</code></pre> <p>This removes the entire <code>~/.config/herd-lite/bin/</code> directory. You'll also want to remove the PATH entries from your shell profile:</p> <pre><code># Remove the two export lines added by php.new\n# Check whichever file was modified: ~/.zshrc, ~/.bashrc, ~/.profile, etc.\ngrep -n \"herd-lite\" ~/.zshrc\n# Then edit the file to remove those lines\n</code></pre>"},{"location":"blog/2026/01/phpnewinstallmac/#full-source","title":"Full source","text":"<p>The full script source is saved as <code>docs/scripts/php_new_install_mac.txt</code>.</p>"},{"location":"blog/2026/01/rawgithubusercontentcombasherpmbashermasterinstallsh/","title":"raw.githubusercontent.com/basherpm/basher/master/install.sh","text":"<p>The basher installer is a minimal 61-line bash script that installs basher, a package manager for shell scripts, via <code>curl -sL https://raw.githubusercontent.com/basherpm/basher/master/install.sh | bash</code>. It git-clones the basher repository into <code>~/.basher</code> and appends initialization lines to the user's shell profile. Zero boilerplate \u2014 no colors, no banners, no spinners. Every line appended to the shell profile is tagged with the marker <code>##basher5ea843</code>, making it trivial to grep and remove them on uninstall. The script supports bash, zsh, sh, and fish, with fish getting its own 5-line initialization block.</p>"},{"location":"blog/2026/01/rawgithubusercontentcombasherpmbashermasterinstallsh/#script-info","title":"Script info","text":"URL <code>https://raw.githubusercontent.com/basherpm/basher/master/install.sh</code> Invocation <code>curl -sL https://raw.githubusercontent.com/basherpm/basher/master/install.sh \\| bash</code> Total lines 61 Comments 10 lines Blank 10 lines Boilerplate 0 lines Installation 40 lines (actual work)"},{"location":"blog/2026/01/rawgithubusercontentcombasherpmbashermasterinstallsh/#what-does-it-change","title":"What does it change?","text":""},{"location":"blog/2026/01/rawgithubusercontentcombasherpmbashermasterinstallsh/#files-and-folders","title":"Files and folders","text":"<ul> <li>Clones the basher repository into <code>~/.basher</code> via <code>git clone https://github.com/basherpm/basher.git ~/.basher</code></li> <li>Checks for an existing installation at both <code>~/.basher</code> and <code>$XDG_DATA_HOME/basher</code> (defaults to <code>~/.local/share/basher</code>) and aborts if either exists</li> </ul>"},{"location":"blog/2026/01/rawgithubusercontentcombasherpmbashermasterinstallsh/#downloads","title":"Downloads","text":"<ul> <li>The entire basher repository from <code>https://github.com/basherpm/basher.git</code> (via git clone)</li> </ul>"},{"location":"blog/2026/01/rawgithubusercontentcombasherpmbashermasterinstallsh/#environment-changes","title":"Environment changes","text":"<p>Appends initialization lines to the shell's startup script, selected by <code>$SHELL</code>:</p> <ul> <li>bash: appends to <code>~/.bashrc</code></li> <li>zsh: appends to <code>~/.zshrc</code></li> <li>sh: appends to <code>~/.profile</code></li> <li>fish: appends to <code>~/.config/fish/config.fish</code></li> </ul> <p>For bash/zsh/sh, two lines are added:</p> <pre><code>export PATH=\"$HOME/.basher/bin:$PATH\"   ##basher5ea843\neval \"$(basher init - bash)\"             ##basher5ea843\n</code></pre> <p>For fish, five lines are added:</p> <pre><code>if test -d ~/.basher          ##basher5ea843\n  set basher ~/.basher/bin    ##basher5ea843\nend                           ##basher5ea843\nset -gx PATH $basher $PATH    ##basher5ea843\nstatus --is-interactive; and . (basher init - fish | psub)    ##basher5ea843\n</code></pre> <p>Every appended line is tagged with <code>##basher5ea843</code> to enable clean removal. The script requires the startup file to already exist \u2014 it aborts if the profile file is missing rather than creating one.</p>"},{"location":"blog/2026/01/rawgithubusercontentcombasherpmbashermasterinstallsh/#uninstall","title":"Uninstall","text":"<p>Remove the basher directory:</p> <pre><code>rm -rf ~/.basher\n</code></pre> <p>Remove the tagged lines from your shell profile:</p> <pre><code># For bash:\ngrep -v \"basher5ea843\" ~/.bashrc &gt; ~/.bashrc.tmp &amp;&amp; mv ~/.bashrc.tmp ~/.bashrc\n\n# For zsh:\ngrep -v \"basher5ea843\" ~/.zshrc &gt; ~/.zshrc.tmp &amp;&amp; mv ~/.zshrc.tmp ~/.zshrc\n\n# For fish:\ngrep -v \"basher5ea843\" ~/.config/fish/config.fish &gt; ~/.config/fish/config.fish.tmp &amp;&amp; mv ~/.config/fish/config.fish.tmp ~/.config/fish/config.fish\n</code></pre> <p>No system-level changes, packages, or services need to be reversed.</p>"},{"location":"blog/2026/01/rawgithubusercontentcombasherpmbashermasterinstallsh/#full-source","title":"Full source","text":"<p>The full script source is saved as <code>docs/scripts/raw_githubusercontent_com_basherpm_basher_master_install_sh.txt</code>.</p>"},{"location":"examples/frankenphp.dev.5a/","title":"frankenphp.dev/install.sh","text":""},{"location":"examples/frankenphp.dev.5a/#description","title":"Description","text":"<ul> <li>run <code>curl -s https://frankenphp.dev/install.sh | bash</code> to install FrankenPHP</li> <li>cf https://frankenphp.dev/docs/ </li> </ul>"},{"location":"examples/frankenphp.dev.5a/#stats","title":"Stats","text":"<pre><code>-------------------------------------------------------------------------------\nLanguage                     files          blank        comment           code\n-------------------------------------------------------------------------------\nBourne Shell                     1             14              2             72\n-------------------------------------------------------------------------------\n</code></pre>"},{"location":"examples/frankenphp.dev.5a/#code","title":"Code","text":"<pre><code>#!/bin/sh\n\nset -e\n\nif [ -z \"${BIN_DIR}\" ]; then\n    BIN_DIR=$(pwd)\nfi\n\nTHE_ARCH_BIN=\"\"\nDEST=${BIN_DIR}/frankenphp\n\nOS=$(uname -s)\nARCH=$(uname -m)\n\nif type \"tput\" &gt;/dev/null 2&gt;&amp;1; then\n    bold=$(tput bold || true)\n    italic=$(tput sitm || true)\n    normal=$(tput sgr0 || true)\nfi\n\ncase ${OS} in\nLinux*)\n    case ${ARCH} in\n    aarch64)\n        THE_ARCH_BIN=\"frankenphp-linux-aarch64\"\n        ;;\n    x86_64)\n        THE_ARCH_BIN=\"frankenphp-linux-x86_64\"\n        ;;\n    *)\n        THE_ARCH_BIN=\"\"\n        ;;\n    esac\n    ;;\nDarwin*)\n    case ${ARCH} in\n    arm64)\n        THE_ARCH_BIN=\"frankenphp-mac-arm64\"\n        ;;\n    *)\n        THE_ARCH_BIN=\"frankenphp-mac-x86_64\"\n        ;;\n    esac\n    ;;\nWindows | MINGW64_NT*)\n    echo \"\u2757 Use WSL to run FrankenPHP on Windows: https://learn.microsoft.com/windows/wsl/\"\n    exit 1\n    ;;\n*)\n    THE_ARCH_BIN=\"\"\n    ;;\nesac\n\nif [ -z \"${THE_ARCH_BIN}\" ]; then\n    echo \"\u2757 FrankenPHP is not supported on ${OS} and ${ARCH}\"\n    exit 1\nfi\n\nSUDO=\"\"\n\necho \"\ud83d\udce6 Downloading ${bold}FrankenPHP${normal} for ${OS} (${ARCH}):\"\n\n# check if $DEST is writable and suppress an error message\ntouch \"${DEST}\" 2&gt;/dev/null\n\n# we need sudo powers to write to DEST\nif [ $? -eq 1 ]; then\n    echo \"\u2757 You do not have permission to write to ${italic}${DEST}${normal}, enter your password to \ngrant sudo powers\"\n    SUDO=\"sudo\"\nfi\n\nif type \"curl\" &gt;/dev/null 2&gt;&amp;1; then\n    curl -L --progress-bar \n\"https://github.com/dunglas/frankenphp/releases/latest/download/${THE_ARCH_BIN}\" -o \"${DEST}\"\nelif type \"wget\" &gt;/dev/null 2&gt;&amp;1; then\n    ${SUDO} wget \"https://github.com/dunglas/frankenphp/releases/latest/download/${THE_ARCH_BIN}\" -O \n\"${DEST}\"\nelse\n    echo \"\u2757 Please install ${italic}curl${normal} or ${italic}wget${normal} to download FrankenPHP\"\n    exit 1\nfi\n\n${SUDO} chmod +x \"${DEST}\"\n\necho\necho \"\ud83e\udd73 FrankenPHP downloaded successfully to ${italic}${DEST}${normal}\"\necho \"\ud83d\udd27 Move the binary to ${italic}/usr/local/bin/${normal} or another directory in your \n${italic}PATH${normal} to use it globally:\"\necho \"   ${bold}sudo mv ${DEST} /usr/local/bin/${normal}\"\necho\necho \"\u2b50 If you like FrankenPHP, please give it a star on GitHub: \n${italic}https://github.com/dunglas/frankenphp${normal}\"\n</code></pre>"},{"location":"examples/install.sandstorm.io.69/","title":"install.sandstorm.io","text":""},{"location":"examples/install.sandstorm.io.69/#description","title":"Description","text":"<ul> <li>run <code>curl -s https://install.sandstorm.io | bash</code> to install Sandstorm self-hosting platform</li> <li>cf https://sandstorm.org/install </li> </ul>"},{"location":"examples/install.sandstorm.io.69/#stats","title":"Stats","text":"<pre><code>-------------------------------------------------------------------------------\nLanguage                     files          blank        comment           code\n-------------------------------------------------------------------------------\nBourne Shell                     1            285            464           1403\n-------------------------------------------------------------------------------\n</code></pre>"},{"location":"examples/install.sandstorm.io.69/#code","title":"Code","text":"<pre><code>#! /bin/bash\n\n# This script installs the Sandstorm Personal Cloud Server on your Linux\n# machine. You can run the latest installer directly from the web by doing:\n#\n#     curl https://install.sandstorm.io | bash\n#\n# If `curl|bash` makes you uncomfortable, see other options here:\n#\n#     https://docs.sandstorm.io/en/latest/install/\n#\n# This script only modifies your system in the following ways:\n# - Install Sandstorm into the directory you choose, typically /opt/sandstorm.\n# - Optionally add an initscript or systemd service:\n#     /etc/init.d/sandstorm\n#     /etc/systemd/system/sandstorm.service\n# - Add commands \"sandstorm\" and \"spk\" to /usr/local/bin.\n#\n# Once installed, you may uninstall with the command: sandstorm uninstall\n#\n# The script will ask you whether you're OK with giving it root privileges.\n# If you refuse, the script can still install Sandstorm (to a directory you\n# own), but will not be able to install the initscript or shortcut commands,\n# and the dev tools will not work (due to limitations with using FUSE in a\n# sandbox).\n#\n# This script downloads and installs binaries. This means that to use this\n# script, you need to trust that the authors are not evil, or you must use\n# an isolated machine or VM. Of course, since the Sandstorm authors'\n# identities are widely known, if they did try to do anything evil, you\n# could easily get them arrested. That said, if you'd rather install from\n# 100% auditable source code, please check out the Github repository instead.\n#\n# All downloads occur over HTTPS from Sandstorm's servers and are further\n# verified using PGP.\n\nif test -z \"$BASH_VERSION\"; then\n  echo \"Please run this script using bash, not sh or any other shell.\" &gt;&amp;2\n  exit 1\nfi\n\n# We wrap the entire script in a big function which we only call at the very end, in order to\n# protect against the possibility of the connection dying mid-script. This protects us against\n# the problem described in this blog post:\n#   http://blog.existentialize.com/dont-pipe-to-your-shell.html\n_() {\n\nset -euo pipefail\n\n# Declare an array so that we can capture the original arguments.\ndeclare -a ORIGINAL_ARGS\n\n# Allow the environment to override curl's User-Agent parameter. We\n# use this to distinguish probably-actual-users installing Sandstorm\n# from the automated test suite, which invokes the install script with\n# this environment variable set.\nCURL_USER_AGENT=\"${CURL_USER_AGENT:-sandstorm-install-script}\"\n\n# Define I/O helper functions.\nerror() {\n  if [ $# != 0 ]; then\n    echo -en '\\e[0;31m' &gt;&amp;2\n    echo \"$@\" | (fold -s || cat) &gt;&amp;2\n    echo -en '\\e[0m' &gt;&amp;2\n  fi\n}\n\nfail() {\n  local error_code=\"$1\"\n  shift\n  if [ \"${SHOW_FAILURE_MSG:-yes}\" = \"yes\" ] ; then\n    echo \"*** INSTALLATION FAILED ***\" &gt;&amp;2\n    echo \"\"\n  fi\n  error \"$@\"\n  echo \"\" &gt;&amp;2\n\n  if [ \"$error_code\" = E_CURL_MISSING ] ; then\n    # There's no point in asking the user if they want to report an issue, since\n    # (1) there isn't one, they just need to install curl, and (2) doing so will\n    # fail anyway, since we use curl to send the report. We've already displayed\n    # the error, so just exit now.\n    exit 1\n  fi\n\n  # Users can export REPORT=no to avoid the error-reporting behavior, if they need to.\n  if [ \"${REPORT:-yes}\" = \"yes\" ] ; then\n    if USE_DEFAULTS=no prompt-yesno \"Hmm, installation failed. Would it be OK to send an anonymous error \nreport to the sandstorm.io team so we know something is wrong?\nIt would only contain this error code: $error_code\" \"yes\" ; then\n      echo \"Sending problem report...\" &gt;&amp;2\n      local BEARER_TOKEN=\"4-Og3Ty2SPmpkZGnVc_8hnBGXK0JBBXDeBn_55FWixJ\"\n      local API_ENDPOINT=\"https://alpha-api-df09d5faefd551337b59659de8ae7207.sandstorm.io\"\n      local HTTP_STATUS=$(\n        dotdotdot_curl \\\n          --silent \\\n          --max-time 20 \\\n          --data-binary \"{\\\"error_code\\\":\\\"$error_code\\\",\\\"user-agent\\\":\\\"$CURL_USER_AGENT\\\"}\" \\\n          -H \"Authorization: Bearer $BEARER_TOKEN\" \\\n          -X POST \\\n          --output \"/dev/null\" \\\n          -w '%{http_code}' \\\n          \"$API_ENDPOINT\")\n      if [ \"200\" == \"$HTTP_STATUS\" ] ; then\n        echo \"... problem reported successfully. Your installation did not succeed.\" &gt;&amp;2\n      elif [ \"000\" == \"$HTTP_STATUS\" ] ; then\n        error \"Submitting error report failed. Maybe there is a connectivity problem.\"\n      else\n        error \"Submitting error report resulted in strange HTTP status: $HTTP_STATUS\"\n      fi\n    else\n      echo \"Not sending report.\" &gt;&amp;2\n    fi\n    echo \"\"\n  fi\n  echo \"You can report bugs at: http://github.com/sandstorm-io/sandstorm\" &gt;&amp;2\n  exit 1\n}\n\nretryable_curl() {\n  # This function calls curl to download a file. If the file download fails, it asks the user if it\n  # is OK to retry.\n  local CURL_FAILED=\"no\"\n  curl -A \"${CURL_USER_AGENT}\" -f \"$1\" &gt; \"$2\" || CURL_FAILED=\"yes\"\n  if [ \"yes\" = \"${CURL_FAILED}\" ] ; then\n    if prompt-yesno \"Downloading $1 failed. OK to retry?\" \"yes\" ; then\n      echo \"\" &gt;&amp;2\n      echo \"Download failed. Waiting one second before retrying...\" &gt;&amp;2\n      sleep 1\n      retryable_curl \"$1\" \"$2\"\n    fi\n  fi\n}\n\ndotdotdot_curl() {\n  # This function calls curl, but first prints \"...\" to the screen, in\n  # an attempt to indicate to the user that the script is waiting on\n  # something.\n  #\n  # It then moves the cursor to the start of the line, so that future\n  # echo-ing will overwrite those dots.\n  #\n  # Since the script is -e, and in general we don't have a reliable\n  # thing that we do in the case that curl exits with a non-zero\n  # status code, we don't capture the status code; we allow the script\n  # to abort if curl exits with a non-zero status.\n\n  # Functions calling dotdotdot_curl expect to capture curl's own\n  # stdout. Therefore we do our echo-ing to stderr.\n\n  echo -n '...' &gt;&amp;2\n\n  curl \"$@\"\n\n  echo -ne '\\r' &gt;&amp;2\n}\n\nis_port_bound() {\n  local SCAN_HOST=\"$1\"\n  local SCAN_PORT=\"$2\"\n\n  if [ \"${DEV_TCP_USABLE}\" = \"unchecked\" ] ; then\n    REPORT=no fail \"E_DEV_TCP_UNCHECKED\" \"Programmer error. The author of install.sh used an uninitialized \nvariable.\"\n  fi\n\n  # We also use timeout(1) from coreutils to avoid this process taking a very long\n  # time in the case of e.g. weird network rules or something.\n  if [ \"${DEV_TCP_USABLE}\" = \"yes\" ] ; then\n    if timeout 1 bash -c \": &lt; /dev/tcp/${SCAN_HOST}/${SCAN_PORT}\" 2&gt;/dev/null; then\n      return 0\n    else\n      return 1\n    fi\n  fi\n\n  # If we are using a traditional netcat, then -z (zero i/o mode)\n  # works for scanning-type uses. (Debian defaults to this.)\n  #\n  # If we are using the netcat from the nmap package, then we can use\n  # --recv-only --send-only to get the same behavior. (Fedora defaults\n  # to this.)\n  #\n  # nc will either:\n  #\n  # - return true (exit 0) if it connected to the port, or\n  #\n  # - return false (exit 1) if it failed to connect to the port, or\n  #\n  # - return false (exit 1) if we are passing it the wrong flags.\n  #\n  # So if either if these invocations returns true, then we know the\n  # port is bound.\n  local DEBIAN_STYLE_INDICATED_BOUND=\"no\"\n  ${NC_PATH} -z \"$SCAN_HOST\" \"$SCAN_PORT\" &gt;/dev/null 2&gt;/dev/null &amp;&amp; DEBIAN_STYLE_INDICATED_BOUND=yes\n\n  if [ \"$DEBIAN_STYLE_INDICATED_BOUND\" == \"yes\" ] ; then\n      return 0\n  fi\n\n  # Not sure yet. Let's try the nmap-style way.\n  local NMAP_STYLE_INDICATED_BOUND=\"no\"\n  ${NC_PATH} --wait 1 --recv-only --send-only \"$SCAN_HOST\" \"$SCAN_PORT\" &gt;/dev/null 2&gt;/dev/null &amp;&amp; \\\n      NMAP_STYLE_INDICATED_BOUND=yes\n\n  if [ \"$NMAP_STYLE_INDICATED_BOUND\" == \"yes\" ] ; then\n      return 0\n  fi\n\n  # As far as we can tell, nmap can't connect to the port, so return 1\n  # to indicate it is not bound.\n  return 1\n}\n\n# writeConfig takes a list of shell variable names and saves them, and\n# their contents, to stdout. Therefore, the caller should redirect its\n# output to a config file.\nwriteConfig() {\n  while [ $# -gt 0 ]; do\n    eval echo \"$1=\\$$1\"\n    shift\n  done\n}\n\nprompt() {\n  local VALUE\n\n  # Hack: We read from FD 3 because when reading the script from a pipe, FD 0 is the script, not\n  #   the terminal. We checked above that FD 1 (stdout) is in fact a terminal and then dup it to\n  #   FD 3, thus we can input from FD 3 here.\n  if [ \"yes\" = \"$USE_DEFAULTS\" ] ; then\n    # Print the default.\n    echo \"$2\"\n    return\n  fi\n\n  # We use \"bold\", rather than any particular color, to maximize readability. See #2037.\n  echo -en '\\e[1m' &gt;&amp;3\n  echo -n \"$1 [$2]\" &gt;&amp;3\n  echo -en '\\e[0m ' &gt;&amp;3\n  read -u 3 VALUE\n  if [ -z \"$VALUE\" ]; then\n    VALUE=$2\n  fi\n  echo \"$VALUE\"\n}\n\nprompt-numeric() {\n  local NUMERIC_REGEX=\"^[0-9]+$\"\n  while true; do\n    local VALUE=$(prompt \"$@\")\n\n    if ! [[ \"$VALUE\" =~ $NUMERIC_REGEX ]] ; then\n      echo \"You entered '$VALUE'. Please enter a number.\" &gt;&amp;3\n    else\n      echo \"$VALUE\"\n      return\n    fi\n  done\n}\n\nprompt-yesno() {\n  while true; do\n    local VALUE=$(prompt \"$@\")\n\n    case $VALUE in\n      y | Y | yes | YES | Yes )\n        return 0\n        ;;\n      n | N | no | NO | No )\n        return 1\n        ;;\n    esac\n\n    echo \"*** Please answer \\\"yes\\\" or \\\"no\\\".\"\n  done\n}\n\n# Define global variables that the install script will use to mark its\n# own progress.\n\nUSE_DEFAULTS=\"no\"\nUSE_EXTERNAL_INTERFACE=\"no\"\nUSE_SANDCATS=\"no\"\nSANDCATS_SUCCESSFUL=\"no\"\nUSE_HTTPS=\"no\"\nCURRENTLY_UID_ZERO=\"no\"\nPREFER_ROOT=\"yes\"\nSHOW_MESSAGE_ABOUT_NEEDING_PORTS_OPEN=\"no\"\nSTARTED_SANDSTORM=\"no\"\n\n# Allow the test suite to override the path to netcat in order to\n# reproduce a compatibility issue between different nc versions.\nNC_PATH=\"${OVERRIDE_NC_PATH:-nc}\"\n\n# Allow install.sh to store if bash /dev/tcp works.\nDEV_TCP_USABLE=\"unchecked\"\n\n# Defaults for some config options, so that if the user requests no\n# prompting, they get these values.\nDEFAULT_DIR_FOR_ROOT=\"${OVERRIDE_SANDSTORM_DEFAULT_DIR:-/opt/sandstorm}\"\nDEFAULT_DIR_FOR_NON_ROOT=\"${OVERRIDE_SANDSTORM_DEFAULT_DIR:-${HOME:-opt}/sandstorm}\"\nDEFAULT_SMTP_PORT=\"30025\"\nDEFAULT_UPDATE_CHANNEL=\"dev\"\nDEFAULT_SERVER_USER=\"${OVERRIDE_SANDSTORM_DEFAULT_SERVER_USER:-sandstorm}\"\nSANDCATS_BASE_DOMAIN=\"${OVERRIDE_SANDCATS_BASE_DOMAIN:-sandcats.io}\"\nALLOW_DEV_ACCOUNTS=\"false\"\n\n# Define functions for each stage of the install process.\n\nusage() {\n  echo \"usage: $SCRIPT_NAME [-d] [-e] [-p PORT_NUMBER] [-u] [&lt;bundle&gt;]\" &gt;&amp;2\n  echo \"If &lt;bundle&gt; is provided, it must be the name of a Sandstorm bundle file,\" &gt;&amp;2\n  echo \"like 'sandstorm-123.tar.xz', which will be installed. Otherwise, the script\" &gt;&amp;2\n  echo \"downloads a bundle from the internet via HTTPS.\" &gt;&amp;2\n  echo '' &gt;&amp;2\n  echo 'If -d is specified, the auto-installs with defaults suitable for app development.' &gt;&amp;2\n  echo 'If -e is specified, default to listening on an external interface, not merely loopback.' &gt;&amp;2\n  echo 'If -i is specified, default to (i)nsecure mode where we do not request a HTTPS certificate.' &gt;&amp;2\n  echo 'If -p is specified, use its argument (PORT_NUMBER) as the default port for HTTP. Otherwise, use 6080. \nNote that if the install script enables HTTPS, it will use 443 instead!'\n  echo 'If -u is specified, default to avoiding root priviliges. Note that the dev tools only work if the \nserver has root privileges.' &gt;&amp;2\n  exit 1\n}\n\ndetect_current_uid() {\n  if [ $(id -u) = 0 ]; then\n    CURRENTLY_UID_ZERO=\"yes\"\n  fi\n}\n\ndisable_smtp_port_25_if_port_unavailable() {\n  PORT_25_AVAILABLE=\"no\"\n  if is_port_bound 0.0.0.0 25; then\n    return\n  fi\n  if is_port_bound 127.0.0.1 25; then\n    return\n  fi\n  PORT_25_AVAILABLE=\"yes\"\n}\n\ncheck_if_ports_unavailable() {\n  local PORT_80_AVAILABLE=\"no\"\n  is_port_bound 0.0.0.0 80 || PORT_80_AVAILABLE=\"yes\"\n\n  local PORT_443_AVAILABLE=\"no\"\n  is_port_bound 0.0.0.0 443 || PORT_443_AVAILABLE=\"yes\"\n\n  if [ \"$PORT_443_AVAILABLE\" == \"no\" -o \"$PORT_80_AVAILABLE\" == \"no\" ] ; then\n    SHOW_MESSAGE_ABOUT_NEEDING_PORTS_OPEN=\"yes\"\n  fi\n}\n\n\nhandle_args() {\n  SCRIPT_NAME=$1\n  shift\n\n  while getopts \":deiup:\" opt; do\n    case $opt in\n      d)\n        USE_DEFAULTS=\"yes\"\n        ;;\n      e)\n        USE_EXTERNAL_INTERFACE=\"yes\"\n        ;;\n      i)\n        # TODO(soon): Fix or remove this option, which currently does nothing\n        ;;\n      u)\n        PREFER_ROOT=no\n        ;;\n      p)\n        DEFAULT_PORT=\"${OPTARG}\"\n        ;;\n      *)\n        usage\n        ;;\n    esac\n  done\n\n  # If DEFAULT_PORT didn't get set above, set it to 6080 here.\n  DEFAULT_PORT=\"${DEFAULT_PORT:-6080}\"\n\n  # Keep a copy of the ORIGINAL_ARGS so that, when re-execing ourself,\n  # we can pass them in.\n  ORIGINAL_ARGS=(\"$@\")\n\n  # Pass positional parameters through\n  shift \"$((OPTIND - 1))\"\n\n  if [ $# = 1 ] &amp;&amp; [[ ! $1 =~ ^- ]]; then\n    BUNDLE_FILE=\"$1\"\n  elif [ $# != 0 ]; then\n    usage\n  fi\n}\n\nrerun_script_as_root() {\n  # Note: This function assumes that the caller has requested\n  # permission to use sudo!\n\n  # Pass $@ here to enable the caller to provide environment\n  # variables to bash, which will affect the execution plan of\n  # the resulting install script run.\n\n  # Remove newlines in $@, otherwise when we try to use $@ in a string passed\n  # to 'bash -c' the command gets cut off at the newline. ($@ contains newlines\n  # because at the call site we used escaped newlines for readability.)\n  local ENVVARS=$(echo $@)\n\n  # Add CURL_USER_AGENT to ENVVARS, since we always need to pass this\n  # through.\n  ENVVARS=\"$ENVVARS CURL_USER_AGENT=$CURL_USER_AGENT\"\n\n  if [ \"$(basename $SCRIPT_NAME)\" == bash ]; then\n    # Probably ran like \"curl https://sandstorm.io/install.sh | bash\"\n    echo \"Re-running script as root...\"\n\n    exec sudo bash -euo pipefail -c \"curl -fs -A $CURL_USER_AGENT https://install.sandstorm.io | $ENVVARS \nbash\"\n  elif [ \"$(basename $SCRIPT_NAME)\" == install.sh ] &amp;&amp; [ -e \"$0\" ]; then\n    # Probably ran like \"bash install.sh\" or \"./install.sh\".\n    echo \"Re-running script as root...\"\n    if [ ${#ORIGINAL_ARGS[@]} = 0 ]; then\n      exec sudo $ENVVARS bash \"$SCRIPT_NAME\"\n    else\n      exec sudo $ENVVARS bash \"$SCRIPT_NAME\" \"${ORIGINAL_ARGS[@]}\"\n    fi\n  fi\n\n  # Don't know how to run the script. Let the user figure it out.\n  REPORT=no fail \"E_CANT_SWITCH_TO_ROOT\" \"ERROR: This script could not detect its own filename, so could not \nswitch to root. \\\nPlease download a copy and name it 'install.sh' and run that as root, perhaps using sudo. \\\nTry this command:\n\ncurl https://install.sandstorm.io/ &gt; install.sh &amp;&amp; sudo bash install.sh\"\n}\n\nset_umask() {\n  # Use umask 0022, to minimize how much 'mkdir -m' we have to do, etc. See #2300.\n  umask 0022\n}\n\nassert_on_terminal() {\n  if [ \"no\" = \"$USE_DEFAULTS\" ] &amp;&amp; [ ! -t 1 ]; then\n    REPORT=no fail \"E_NO_TTY\" \"This script is interactive. Please run it on a terminal.\"\n  fi\n\n  # Hack: If the script is being read in from a pipe, then FD 0 is not the terminal input. But we\n  #   need input from the user! We just verified that FD 1 is a terminal, therefore we expect that\n  #   we can actually read from it instead. However, \"read -u 1\" in a script results in\n  #   \"Bad file descriptor\", even though it clearly isn't bad (weirdly, in an interactive shell,\n  #   \"read -u 1\" works fine). So, we clone FD 1 to FD 3 and then use that -- bash seems OK with\n  #   this.\n  exec 3&lt;&amp;1\n}\n\nassert_linux_x86_64() {\n  if [ \"$(uname)\" != Linux ]; then\n    fail \"E_NON_LINUX\" \"Sandstorm requires Linux. If you want to run Sandstorm on a Windows or\nMac system, you can use Vagrant or another virtualization tool. See our install documentation:\n\n- https://docs.sandstorm.io/en/latest/install/\"\n  fi\n\n  if [ \"$(uname -m)\" != x86_64 ]; then\n    fail \"E_NON_X86_64\" \"Sorry, the Sandstorm server currently only runs on x86_64 machines.\"\n  fi\n}\n\nassert_usable_kernel() {\n  KVERSION=( $(uname -r | grep -o '^[0-9.]*' | tr . ' ') )\n\n  if (( KVERSION[0] &lt; 3 || (KVERSION[0] == 3 &amp;&amp; KVERSION[1] &lt; 10) )); then\n    error \"Detected Linux kernel version: $(uname -r)\"\n    fail \"E_KERNEL_OLDER_THAN_310\" \"Sorry, your kernel is too old to run Sandstorm. We require kernel\" \\\n         \"version 3.10 or newer.\"\n  fi\n}\n\nmaybe_enable_userns_sysctl() {\n  # This function enables the Debian/Ubuntu-specific unprivileged\n  # userns sysctl, if the system has it and we want it.\n\n  if [ \"$USE_DEFAULTS\" != \"yes\" ] ; then\n    # Only do this when -d is passed. -d means \"use defaults suitable for app development\", and\n    # we want userns enabled for app development if possible since it enables UID randomization\n    # which helps catch app bugs. For the rest of the world, we're fine using the privileged\n    # sandbox instead.\n    return\n  fi\n\n  if [ \"no\" = \"$CURRENTLY_UID_ZERO\" ] ; then\n    # Not root. Can't do anything about it.\n    return\n  fi\n\n  if [ ! -e /proc/sys/kernel/unprivileged_userns_clone ]; then\n    # No such sysctl on this system.\n    return\n  fi\n\n  local OLD_VALUE=\"$(&lt; /proc/sys/kernel/unprivileged_userns_clone)\"\n\n  if [ \"$OLD_VALUE\" = \"1\" ]; then\n    # Already enabled.\n    return\n  fi\n\n  # Enable it.\n  if sysctl -wq kernel.unprivileged_userns_clone=1 2&gt;/dev/null; then\n    echo \"NOTE: Enabled unprivileged user namespaces because you passed -d.\"\n  else\n    # Apparently we can't. Maybe we're in a Docker container. Give up and use privileged sandbox.\n    return\n  fi\n\n  # Also make sure it is re-enabled on boot. If sysctl.d exists, we drop our own config in there.\n  # Otherwise we edit sysctl.conf, but that's less polite.\n  local SYSCTL_FILENAME=\"/etc/sysctl.conf\"\n  if [ -d /etc/sysctl.d ] ; then\n    SYSCTL_FILENAME=\"/etc/sysctl.d/50-sandstorm.conf\"\n  fi\n\n  if ! cat &gt;&gt; \"$SYSCTL_FILENAME\" &lt;&lt; __EOF__\n\n# Enable non-root users to create sandboxes (needed by Sandstorm).\nkernel.unprivileged_userns_clone = 1\n__EOF__\n  then\n    # We couldn't make the change permanent, so undo the change. Probably everything will work\n    # fine with the privileged sandbox. But if it doesn't, it's better that things fail now rather\n    # than wait for a reboot.\n    echo \"NOTE: Never mind, not enabling userns because can't write /etc/sysctl.d.\"\n    sysctl -wq \"kernel.unprivileged_userns_clone=$OLD_VALUE\" || true\n    return\n  fi\n}\n\ntest_if_dev_tcp_works() {\n  # In is_port_bound(), we prefer to use bash /dev/tcp to check if the port is bound. This is\n  # available on most Linux distributions, but it is a compile-time flag for bash and at least\n  # Debian historically disabled it.\n  #\n  # To test availability, we connect to localhost port 0, which is never available, hoping for a\n  # TCP-related error message from bash. We use a subshell here because we don't care that timeout\n  # will return false; we care if the grep returns false.\n  if (timeout 1 bash -c ': &lt; /dev/tcp/localhost/0' 2&gt;&amp;1 || true) | grep -q 'connect:' ; then\n    # Good! bash should get \"Connection refused\" on this, and this message is prefixed\n    # by the syscall it was trying to do, so therefore it tried to connect!\n    DEV_TCP_USABLE=\"yes\"\n  else\n    DEV_TCP_USABLE=\"no\"\n  fi\n}\n\nassert_dependencies() {\n  if [ -z \"${BUNDLE_FILE:-}\" ]; then\n    which curl &gt; /dev/null|| fail \"E_CURL_MISSING\" \"Please install curl(1). Sandstorm uses it to download \nupdates.\"\n  fi\n\n  # To find out if port 80 and 443 are available, we need a working bash /dev/net or `nc` on\n  # the path.\n  if [ \"${DEV_TCP_USABLE}\" = \"unchecked\" ] ; then\n    test_if_dev_tcp_works\n  fi\n  if [ \"${DEV_TCP_USABLE}\" = \"no\" ] ; then\n    which nc &gt; /dev/null || fail \"E_NC_MISSING\" \"Please install nc(1). (Package may be called \n'netcat-traditional' or 'netcat-openbsd'.)\"\n  fi\n\n  which tar &gt; /dev/null || fail \"E_TAR_MISSING\" \"Please install tar(1).\"\n  which xz &gt; /dev/null || fail \"E_XZ_MISSING\" \"Please install xz(1). (Package may be called 'xz-utils'.)\"\n}\n\nassert_valid_bundle_file() {\n  # ========================================================================================\n  # Validate bundle file, if provided\n\n  if [ -n \"${BUNDLE_FILE:-}\" ]; then\n    # Read the first filename out of the bundle, which should be the root directory name.\n    # We use \"|| true\" here because tar is going to SIGPIPE when `head` exits.\n    BUNDLE_DIR=$( (tar Jtf \"$BUNDLE_FILE\" || true) | head -n 1)\n    if [[ ! \"$BUNDLE_DIR\" =~ sandstorm-([0-9]+)/ ]]; then\n      fail \"E_INVALID_BUNDLE\" \"$BUNDLE_FILE: Not a valid Sandstorm bundle\"\n    fi\n\n    BUILD=${BASH_REMATCH[1]}\n\n    # We're going to change directory, so note the bundle's full name.\n    BUNDLE_FILE=$(readlink -f \"$BUNDLE_FILE\")\n  fi\n}\n\ndetect_init_system() {\n  # We start out by not knowing which init system is in use.\n  INIT_SYSTEM=\"unknown\"\n\n  # We look for systemd, since we have a nice way to generate a unit file.\n  if grep -q systemd /proc/1/comm; then\n    INIT_SYSTEM=\"systemd\"\n    return\n  fi\n\n  # We look for sysvinit, as a convenient fallback. Note that this\n  # should work fine with Upstart (on e.g. Ubuntu 14.04), too.\n  if [ -e /etc/init.d ]; then\n    INIT_SYSTEM=\"sysvinit\"\n    return\n  fi\n\n  # If we got this far, and we couldn't figure out the init system\n  # in use, that's life.\n}\n\nchoose_install_mode() {\n  echo -n 'Sandstorm makes it easy to run web apps on your own server. '\n\n  if [ \"yes\" = \"$USE_DEFAULTS\" ] ; then\n    CHOSEN_INSTALL_MODE=\"${CHOSEN_INSTALL_MODE:-development}\"  # dev server mode by default\n  fi\n\n  if [ \"no\" = \"${PREFER_ROOT:-}\" ] ; then\n    echo \"\"\n    echo \"NOTE: Showing you all options, including development options, but omitting \"\n    echo \"      init script automation, because you chose to install without using root.\"\n    CHOSEN_INSTALL_MODE=\"${CHOSEN_INSTALL_MODE:-development}\"  # dev server mode by default\n  fi\n\n  if [ -z \"${CHOSEN_INSTALL_MODE:-}\" ]; then\n    echo \"You can have:\"\n    echo \"\"\n    echo \"1. A typical install, to use Sandstorm (press enter to accept this default)\"\n    echo \"2. A development server, for working on Sandstorm itself or localhost-based app development\"\n    echo \"\"\n    CHOSEN_INSTALL_MODE=$(prompt-numeric \"How are you going to use this Sandstorm install?\" \"1\")\n  fi\n\n  if [ \"$CHOSEN_INSTALL_MODE\" = \"production\" ] || [ \"$CHOSEN_INSTALL_MODE\" = \"1\" ] ; then\n    assert_full_server_dependencies\n    full_server_install\n  else\n    dev_server_install\n  fi\n}\n\nassert_full_server_dependencies() {\n  # To set up sandcats, we need `openssl` on the path. Check for that,\n  # and if it is missing, bail out and tell the user they have to\n  # install it.\n  which openssl &gt; /dev/null|| fail \"E_OPENSSL_MISSING\" \"Please install openssl(1). Sandstorm uses it for the \nSandcats.io dynamic DNS service.\"\n}\n\ndev_server_install() {\n  # Use these settings for a dev-server-oriented install.\n  #\n  # Users will find themselves going through this flow if they\n  # manually choose a dev-server-related flow, but also if they pass\n  # -d on the command line. (The Vagrantfile and the test suite both\n  # use -d. The test suite runs install.sh with -d -u.)\n  #\n  # A \"dev server install\" must be run as root, unless you pass\n  # -u. That's because app development (aka spk dev) requires running\n  # as root, at the moment.\n\n  if [ \"yes\" = \"$PREFER_ROOT\" ] &amp;&amp; [ \"no\" = \"$CURRENTLY_UID_ZERO\" ] ; then\n    # We are not root, but we would like to be root.\n    echo \"If you want app developer mode for a Sandstorm install, you need root\"\n    echo \"due to limitations in the Linux kernel.\"\n    echo \"\"\n\n    echo \"To set up Sandstorm, we will use sudo to switch to root, then\"\n    echo \"provide further information before doing the install.\"\n    echo \"Sandstorm's database and web interface won't run as root.\"\n\n    # If we are running in USE_DEFAULTS mode, then it is not OK to ask\n    # for permission to use sudo.\n    if [ \"yes\" = \"$USE_DEFAULTS\" ] ; then\n      ACCEPTED_SUDO_FOR_DEV_SERVER=\"no\"\n    else\n      if prompt-yesno \"OK to continue?\" \"yes\" ; then\n        ACCEPTED_SUDO_FOR_DEV_SERVER=\"yes\"\n      else\n        ACCEPTED_SUDO_FOR_DEV_SERVER=\"no\"\n      fi\n    fi\n\n    if [ \"yes\" = \"$ACCEPTED_SUDO_FOR_DEV_SERVER\" ] ; then\n      rerun_script_as_root CHOSEN_INSTALL_MODE=development\n    else\n      # Print a message that allows people to make an informed decision.\n      SHOW_FAILURE_MSG=no REPORT=no fail \"E_NEED_ROOT\" \"\nOne development feature does require root. To install anyway, run:\n\ninstall.sh -u\n\nto install without using root access. In that case, Sandstorm will operate OK but package tracing ('spk dev') \nwill not work.\"\n    fi\n  fi\n\n  # If they did not pass -d, then let them opt into that, but only if\n  # PREFER_ROOT is still enabled.\n  #\n  # If they pass -u without -d, then they can answer the questions one\n  # by one.\n  if [ \"yes\" != \"$USE_DEFAULTS\" ] &amp;&amp; [ \"yes\" = \"$PREFER_ROOT\" ] ; then\n    echo \"We're going to:\"\n    echo \"\"\n    echo \"* Install Sandstorm in ${DEFAULT_DIR_FOR_ROOT}.\"\n    echo \"* Automatically keep Sandstorm up-to-date (with signed updates).\"\n    echo \"* Create a service user ($DEFAULT_SERVER_USER) that owns Sandstorm's files.\"\n    if [ -n \"${SUDO_USER:-}\" ]; then\n      echo \"* Add you ($SUDO_USER) to the $DEFAULT_SERVER_USER group so you can read/write app data.\"\n    fi\n    echo \"* Expose the service only on localhost aka local.sandstorm.io, not the public Internet.\"\n    echo \"* Enable 'dev accounts', for easy developer login.\"\n    if [ \"unknown\" == \"$INIT_SYSTEM\" ]; then\n      echo \"*** WARNING: Could not detect how to run Sandstorm at startup on your system. ***\"\n    else\n        echo \"* Configure Sandstorm to start on system boot (with $INIT_SYSTEM).\"\n    fi\n    echo \"* Listen for inbound email on port ${DEFAULT_SMTP_PORT}.\"\n    echo \"\"\n\n    if prompt-yesno \"Press enter to accept defaults. Type 'no' to customize.\" \"yes\" ; then\n      USE_DEFAULTS=\"yes\"\n    else\n      echo \"\"\n      echo \"OK. We will prompt you with every question.\"\n      echo \"\"\n    fi\n\n  fi\n\n  if [ \"yes\" = \"$USE_DEFAULTS\" ] ; then\n    # Use the default UPDATE_CHANNEL for auto-updates.\n    UPDATE_CHANNEL=\"$DEFAULT_UPDATE_CHANNEL\"\n\n    # Bind to localhost, unless -e specified in argv.\n    USE_EXTERNAL_INTERFACE=\"${USE_EXTERNAL_INTERFACE:-no}\"\n\n    # Use local.sandstorm.io as hostname unless environment variable declared otherwise. This\n    # short-circuits the code elsewhere that uses the system hostname if USE_EXTERNAL_INTERFACE is\n    # \"yes\".\n    SS_HOSTNAME=\"${SS_HOSTNAME:-local.sandstorm.io}\"\n\n    # Use 30025 as the default SMTP_LISTEN_PORT.\n    SMTP_LISTEN_PORT=\"${DEFAULT_SMTP_PORT}\"\n\n    # Start the service at boot, if we can.\n    START_AT_BOOT=\"yes\"\n\n    # Do not ask questions about our dynamic DNS service.\n    USE_SANDCATS=\"no\"\n\n    # Reasonable default ports.\n    PORT=\"${DEFAULT_PORT}\"\n\n    # Allow the mongo prompting part to determine a reasonable MONGO_PORT.\n\n    # Use the ALLOW_DEV_ACCOUNTS feature, which allows people to log\n    # into a Sandstorm instance without setting up any accounts.\n    ALLOW_DEV_ACCOUNTS=\"yes\"\n\n    # Do not bother setting a DESIRED_SERVER_USER. This way, the\n    # existing prompting will pick if this should be \"sandstorm\" (which\n    # it should be if we're running the install script as root) or the\n    # currently-logged-in user (which it should be if we're not root).\n\n    # Do not bother setting a DIR. This way, the existing prompting will\n    # pick between /opt/sandstorm and $HOME/sandstorm, depending on if\n    # the install is being done as root or not. It will use /opt/sandstorm\n    # in all cases if the script is run without the HOME environment variable.\n  fi\n}\n\nfull_server_install() {\n  # The full server install assumes you are OK with using root. If\n  # you're not, you should choose the development server and customize\n  # it to your heart's content.\n  if [ \"yes\" != \"${PREFER_ROOT}\" ] ; then\n    REPORT=no fail \"E_AUTO_NEEDS_SUDO\" \"The automatic setup process requires sudo. Try again with option 2, \ndevelopment server, to customize.\"\n  fi\n\n  if [ \"yes\" = \"$USE_DEFAULTS\" ] ; then\n    if [ -z \"${DESIRED_SANDCATS_NAME-}\" ] ; then\n      local MSG=\"For now, USE_DEFAULTS for full server installs requires a DESIRED_SANDCATS_NAME variable.\"\n      MSG=\"$MSG If you need support for non-sandcats full-server unattended installs, please file a bug.\"\n      fail \"E_USE_DEFAULTS_NEEDS_DESIRED_SANDCATS_NAME\" \"$MSG\"\n    else\n      if [ -z \"${SANDCATS_DOMAIN_RESERVATION_TOKEN:-}\" ] ; then\n        local MSG=\"When operating in USE_DEFAULTS mode, if you want a sandcats.io domain,\"\n        MSG=\"$MSG you must pre-reserve it before running this script. Specify it via the\"\n        MSG=\"$MSG SANDCATS_DOMAIN_RESERVATION_TOKEN environment variable.\"\n        fail \"E_USE_DEFAULTS_NEEDS_DESIRED_SANDCATS_NAME\" \"$MSG\"\n      fi\n    fi\n\n    # If they said USE_DEFAULTS then they don't need to be prompted.\n    ACCEPTED_FULL_SERVER_INSTALL=\"yes\"\n  fi\n\n  # Use port 25 for email, if we can. This logic only gets executed for \"full servers.\"\n  disable_smtp_port_25_if_port_unavailable\n  local PLANNED_SMTP_PORT=\"30025\"\n  if [ \"yes\" = \"$PORT_25_AVAILABLE\" ] ; then\n    PLANNED_SMTP_PORT=\"25\"\n  fi\n\n  if [ \"yes\" != \"${RERUNNING_AS_ROOT:-}\" ]; then\n    # Determine whether to show the ports unavailable warning\n    check_if_ports_unavailable\n\n    echo \"We're going to:\"\n    echo \"\"\n    echo \"* Install Sandstorm in $DEFAULT_DIR_FOR_ROOT\"\n    echo \"* Automatically keep Sandstorm up-to-date\"\n    echo \"* Configure auto-renewing HTTPS if you use a subdomain of sandcats.io\"\n    echo \"* Create a service user ($DEFAULT_SERVER_USER) that owns Sandstorm's files\"\n    if [ \"unknown\" == \"$INIT_SYSTEM\" ]; then\n      echo \"*** WARNING: Could not detect how to run Sandstorm at startup on your system. ***\"\n    else\n      echo \"* Configure Sandstorm to start on system boot (with $INIT_SYSTEM)\"\n    fi\n    echo \"* Listen for inbound email on port ${PLANNED_SMTP_PORT}.\"\n    echo \"\"\n\n    # If we're not root, we will ask if it's OK to use sudo.\n    if [ \"yes\" != \"$CURRENTLY_UID_ZERO\" ]; then\n      echo \"To set up Sandstorm, we will need to use sudo.\"\n    else\n      echo \"Rest assured that Sandstorm itself won't run as root.\"\n    fi\n\n    if [ -z \"${ACCEPTED_FULL_SERVER_INSTALL:-}\" ]; then\n      if prompt-yesno \"OK to continue?\" \"yes\"; then\n        ACCEPTED_FULL_SERVER_INSTALL=yes\n      else\n        ACCEPTED_FULL_SERVER_INSTALL=no\n      fi\n    fi\n\n    if [ \"yes\" = \"$ACCEPTED_FULL_SERVER_INSTALL\" ] &amp;&amp;\n      [ \"yes\" = \"$SHOW_MESSAGE_ABOUT_NEEDING_PORTS_OPEN\" ] ; then\n      echo \"\"\n      echo \"NOTE: It looks like your system already has some other web server installed\"\n      echo \"      (port 80 and/or 443 are taken), so Sandstorm cannot act as your main\"\n      echo \"      web server.\"\n      echo \"\"\n      echo \"      This script can set up Sandstorm to run on port $DEFAULT_PORT instead,\"\n      echo \"      without HTTPS. This makes sense if you're OK with typing the port number\"\n      echo \"      into your browser whenever you access Sandstorm and you don't need\"\n      echo \"      security. This also makes sense if you are going to set up a reverse proxy;\"\n      echo \"      if so, see https://docs.sandstorm.io/en/latest/administering/reverse-proxy/\"\n      echo \"\"\n      echo \"      If you want, you can quit this script with Ctrl-C now, and go uninstall\"\n      echo \"      your other web server, and then run this script again. It is also OK to\"\n      echo \"      proceed if you want.\"\n      echo \"\"\n      if ! prompt-yesno \"OK to skip automatic HTTPS setup &amp; bind to port $DEFAULT_PORT instead?\" \"yes\" ; then\n        fail \"E_USER_REFUSED_DEFAULT_PORT\" \"Exiting now. You can re-run the installer whenever you are ready.\"\n      fi\n    fi\n\n    # If they are OK continuing, and the script is not running as root\n    # at the moment, then re-run ourselves as root.\n    #\n    # Pass along enough information so that the script will keep\n    # executing smoothly, so the user doesn't have to re-answer\n    # questions.\n    if [ \"yes\" != \"$CURRENTLY_UID_ZERO\" ] ; then\n      if [ \"yes\" = \"$ACCEPTED_FULL_SERVER_INSTALL\" ] ; then\n        rerun_script_as_root CHOSEN_INSTALL_MODE=production \\\n                             ACCEPTED_FULL_SERVER_INSTALL=yes \\\n                             RERUNNING_AS_ROOT=yes \\\n                             DESIRED_SANDCATS_NAME=\"${DESIRED_SANDCATS_NAME:-}\" \\\n                             SANDCATS_REGISTRATION_EMAIL=\"${SANDCATS_REGISTRATION_EMAIL:-}\" \\\n                             ACME_EMAIL=\"${ACME_EMAIL:-}\" \\\n                             OVERRIDE_SANDCATS_BASE_DOMAIN=\"${OVERRIDE_SANDCATS_BASE_DOMAIN:-}\" \\\n                             OVERRIDE_SANDCATS_API_BASE=\"${OVERRIDE_SANDCATS_API_BASE:-}\" \\\n                             OVERRIDE_NC_PATH=\"${OVERRIDE_NC_PATH:-}\" \\\n                             OVERRIDE_SANDCATS_CURL_PARAMS=\"${OVERRIDE_SANDCATS_CURL_PARAMS:-}\"\n      fi\n\n      # If we're still around, it means they declined to run us as root.\n      echo \"\"\n      echo \"The automatic setup script needs root in order to:\"\n      echo \"* Create a separate user to run Sandstorm as, and\"\n      echo \"* Set up Sandstorm to start on system boot.\"\n      echo \"\"\n      fail \"E_DECLINED_AUTO_SETUP_DETAILS\" \"For a customized install, please re-run install.sh, and choose \noption (2) \"\\\n           \"to do a development install.\"\n    fi\n  fi\n\n  # Accepting this indicates a few things.\n  if [ \"yes\" = \"${ACCEPTED_FULL_SERVER_INSTALL}\" ]; then\n    UPDATE_CHANNEL=\"$DEFAULT_UPDATE_CHANNEL\"\n    DIR=\"$DEFAULT_DIR_FOR_ROOT\"\n    USE_EXTERNAL_INTERFACE=\"yes\"\n    USE_SANDCATS=\"yes\"\n    START_AT_BOOT=\"yes\"\n    DESIRED_SERVER_USER=\"$DEFAULT_SERVER_USER\"\n    PORT=\"${DEFAULT_PORT}\"\n    MONGO_PORT=\"6081\"\n    SMTP_LISTEN_PORT=\"${PLANNED_SMTP_PORT}\"\n  else\n    REPORT=no fail \"E_USER_WANTS_CUSTOM_SETTINGS\" \"If you prefer a more manual setup experience, try \ninstalling in development mode.\"\n  fi\n}\n\nsandcats_configure() {\n  # We generate the public key before prompting for a desired hostname\n  # so that when the user presses enter, we can try to register the\n  # hostname, and if that succeeds, we are totally done. This avoids a\n  # possible time-of-check-time-of-use race.\n  echo -n \"As a Sandstorm user, you are invited to use a free Internet hostname \"\n  echo \"as a subdomain of sandcats.io,\"\n  echo \"a service operated by the Sandstorm development team.\"\n\n  sandcats_generate_keys\n\n  echo \"\"\n  echo \"Sandcats.io protects your privacy and is subject to terms of use. By using it,\"\n  echo \"you agree to the terms of service &amp; privacy policy available here:\"\n  echo \"https://sandcats.io/terms https://sandcats.io/privacy\"\n  echo \"\"\n\n  # Having set up the keys, we run the function to register a name\n  # with Sandcats. This function handles tail-recursing itself until\n  # it succeeds and/or returning when the user expresses a desire to\n  # cancel the process.\n  sandcats_register_name\n}\n\nconfigure_hostnames() {\n  if [ \"yes\" = \"$USE_SANDCATS\" ] ; then\n    # If we're lucky, the user will be happy with the Sandcats\n    # hostname configuration. If not, then we'll have to actually\n    # prompt them.\n    sandcats_configure\n  fi\n\n  # Ask the user for port number information. (These functions\n  # optionally skip the questions if the details have already been\n  # filled in.)\n  choose_port\n  choose_mongo_port\n\n  # If we are supposed to use the external network interface, then\n  # configure the hostname and IP address accordingly.\n  if [ \"yes\" = \"$USE_EXTERNAL_INTERFACE\" ]; then\n    BIND_IP=0.0.0.0\n    SS_HOSTNAME=\"${SS_HOSTNAME:-$(hostname -f 2&gt;/dev/null || hostname)}\"\n  else\n    BIND_IP=127.0.0.1\n    SS_HOSTNAME=local.sandstorm.io\n    if [ \"yes\" != \"$USE_DEFAULTS\" ] ; then\n      echo \"Note: local.sandstorm.io maps to 127.0.0.1, i.e. your local machine.\"\n      echo \"For reasons that will become clear in the next step, you should use this\"\n      echo \"instead of 'localhost'.\"\n    fi\n  fi\n\n  # A typical server's DEFAULT_BASE_URL is its hostname plus port over HTTP. If the port is 80, then\n  # don't add it to BASE_URL to avoid triggering this bug:\n  # https://github.com/sandstorm-io/sandstorm/issues/2252\n  local PORT_SUFFIX=\"\"\n  if [ \"$PORT\" = \"80\" ] ; then\n    PORT_SUFFIX=\"\"\n  else\n    PORT_SUFFIX=\":${PORT}\"\n  fi\n\n  DEFAULT_BASE_URL=\"http://${SS_HOSTNAME}${PORT_SUFFIX}\"\n\n  if [ \"$USE_HTTPS\" = \"yes\" ]; then\n    DEFAULT_BASE_URL=\"https://$SS_HOSTNAME\"\n    HTTPS_PORT=443\n    PORT=80\n  fi\n\n  if [ \"yes\" = \"$SANDCATS_SUCCESSFUL\" ] ; then\n    # Do not prompt for BASE_URL configuration if Sandcats bringup\n    # succeeded.\n    BASE_URL=\"$DEFAULT_BASE_URL\"\n  else\n    BASE_URL=$(prompt \"URL users will enter in browser:\" \"$DEFAULT_BASE_URL\")\n    if ! [[ \"$BASE_URL\" =~ ^http(s?):// ]] ; then\n      local PROPOSED_BASE_URL=\"http://${BASE_URL}\"\n      echo \"** You entered ${BASE_URL}, which needs http:// at the front. I can use:\" &gt;&amp;2\n      echo \"        ${PROPOSED_BASE_URL}\" &gt;&amp;2\n      if prompt-yesno \"Is this OK?\" yes; then\n        BASE_URL=\"${PROPOSED_BASE_URL}\"\n      else\n        configure_hostnames\n      fi\n    fi\n  fi\n\n  # If the BASE_URL looks like localhost, then we had better use a\n  # DEFAULT_WILDCARD of local.sandstorm.io so that wildcard DNS works.\n  if [[ \"$BASE_URL\" =~ ^http://localhost(|:[0-9]*)(/.*)?$ ]]; then\n    DEFAULT_WILDCARD=*.local.sandstorm.io${BASH_REMATCH[1]}\n  elif [[ \"$BASE_URL\" =~ ^[^:/]*://([^/]*)/?$ ]]; then\n    DEFAULT_WILDCARD=\"${DEFAULT_WILDCARD:-*.${BASH_REMATCH[1]}}\"\n  else\n    DEFAULT_WILDCARD=\n  fi\n\n  # If we did the sandcats configuration, then we trust it to provide\n  # a working WILDCARD_HOST.\n  if [ \"yes\" = \"$SANDCATS_SUCCESSFUL\" ] ; then\n    WILDCARD_HOST=\"$DEFAULT_WILDCARD\"\n  else\n    if [ \"yes\" != \"$USE_DEFAULTS\" ] ; then\n      echo \"Sandstorm requires you to set up a wildcard DNS entry pointing at the server.\"\n      echo \"This allows Sandstorm to allocate new hosts on-the-fly for sandboxing purposes.\"\n      echo \"Please enter a DNS hostname containing a '*' which maps to your server. For \"\n      echo \"example, if you have mapped *.foo.example.com to your server, you could enter\"\n      echo \"\\\"*.foo.example.com\\\". You can also specify that hosts should have a special\"\n      echo \"prefix, like \\\"ss-*.foo.example.com\\\". Note that if your server's main page\"\n      echo \"is served over SSL, the wildcard address must support SSL as well, which\"\n      echo \"implies that you must have a wildcard certificate. For local-machine servers,\"\n      echo \"we have mapped *.local.sandstorm.io to 127.0.0.1 for your convenience, so you\"\n      echo \"can use \\\"*.local.sandstorm.io\\\" here. If you are serving off a non-standard\"\n      echo \"port, you must include it here as well.\"\n    fi\n    WILDCARD_HOST=$(prompt \"Wildcard host:\" \"$DEFAULT_WILDCARD\")\n\n    while ! [[ \"$WILDCARD_HOST\" =~ ^[^*]*[*][^*]*$ ]]; do\n      error \"Invalid wildcard host. It must contain exactly one asterisk.\"\n      WILDCARD_HOST=$(prompt \"Wildcard host:\" \"$DEFAULT_WILDCARD\")\n    done\n  fi\n}\n\nchoose_install_dir() {\n  if [ -z \"${DIR:-}\" ] ; then\n    local DEFAULT_DIR=\"$DEFAULT_DIR_FOR_ROOT\"\n    if [ \"yes\" != \"$CURRENTLY_UID_ZERO\" ] ; then\n      DEFAULT_DIR=\"$DEFAULT_DIR_FOR_NON_ROOT\"\n    fi\n\n    DIR=$(prompt \"Where would you like to put Sandstorm?\" \"$DEFAULT_DIR\")\n  fi\n\n  # Check for the existence of any partial Sandstorm installation. Note that by default, the\n  # Sandstorm uninstall process will retain $DIR/sandstorm.conf and $DIR/var. Since the install\n  # script can't reliably use those to preseed a new Sandstorm install, we still bail out in that\n  # situation.\n  if [ -e \"$DIR/sandstorm.conf\" ] || [ -e \"$DIR/var\" ] || [ -e \"$DIR/sandstorm\" ] ; then\n    # Clear the previous line, since in many cases, it's a \"echo -n\".\n    error \"\"\n    error \"This script is trying to install to ${DIR}.\"\n    error \"\"\n    error \"You seem to already have a ${DIR} directory with a Sandstorm installation inside. You should \neither:\"\n    error \"\"\n    error \"1. Reconfigure that Sandstorm install using its configuration file -- ${DIR}/sandstorm.conf -- or \nthe admin interface. See docs at:\"\n    error \"https://docs.sandstorm.io/en/latest/administering/\"\n    error \"\"\n    error \"2. Uninstall Sandstorm before attempting to perform a new install. Even if you created a \nsandcats.io hostname, it is safe to uninstall so long as you do not need the data in your Sandstorm install. \nWhen you re-install Sandstorm, you can follow a process to use the old hostname with the new install. See \nuninstall docs at:\"\n    error \"https://docs.sandstorm.io/en/latest/install/#uninstall\"\n    error \"\"\n    error \"3. Use a different target directory for the new Sandstorm install. Try running install.sh with the \n-d option.\"\n    error \"\"\n    error \"4. Retain your data, but restore your Sandstorm code and configuration to a fresh copy. To do \nthat, keep a backup  of ${DIR}/var and then do a fresh install; stop the Sandstorm service, and restore your \nbackup of ${DIR}/var. You may need to adjust permissions after doing that.\"\n    REPORT=no fail \"E_DIR_ALREADY_EXISTS\" \"Please try one of the above. Contact \nhttps://groups.google.com/d/forum/sandstorm-dev for further help.\"\n  fi\n\n  mkdir -p \"$DIR\"\n  cd \"$DIR\"\n}\n\nchoose_smtp_port() {\n  # If SMTP_LISTEN_PORT is already decided, then don't bother asking.\n  if [ ! -z \"${SMTP_LISTEN_PORT:-}\" ] ; then\n    return\n  fi\n\n  local REQUESTED_SMTP_PORT=$(prompt-numeric \"Sandstorm grains can receive email. What port should Sandstorm \nlisten on, for inbound SMTP?\" \"${DEFAULT_SMTP_PORT}\")\n  if [ -z \"${REQUESTED_SMTP_PORT}\" ] ; then\n    choose_smtp_port\n  else\n    SMTP_LISTEN_PORT=\"${REQUESTED_SMTP_PORT}\"\n  fi\n}\n\nload_existing_settings() {\n  # If there is no settings file to load, then we can skip the\n  # rest of this function.\n  if [ ! -e sandstorm.conf ]; then\n    return\n  fi\n\n  echo \"Found existing sandstorm.conf. Using it.\"\n  . sandstorm.conf\n  if [ \"${SERVER_USER:+set}\" != set ]; then\n    fail \"E_CONF_DOES_NOT_SET_SERVER_USER\" \"Existing config does not set SERVER_USER. Please fix or delete \nit.\"\n  fi\n\n  # If sandstorm.conf specifies an UPDATE_CHANNEL, then make that be\n  # the default. Additionally, because UPDATE_CHANNEL is already\n  # set, the part of the code that prompts the user about what\n  # UPDATE_CHANNEL they want should skip itself.\n  if [ \"${UPDATE_CHANNEL:-none}\" != none ]; then\n    DEFAULT_UPDATE_CHANNEL=$UPDATE_CHANNEL\n  fi\n}\n\nchoose_server_user_if_needed() {\n  # If there is already a sandstorm.conf, we assume that it has a\n  # SERVER_USER set and that the user exists. This is a\n  # basically-reasonable assumption, given that\n  # load_existing_settings() verifies that there is a SERVER_USER set.\n  if [ -e sandstorm.conf ] ; then\n    return\n  fi\n\n  # If we are not root, then life is easy; we run Sandstorm as the current\n  # user.\n  if [ \"yes\" != \"$CURRENTLY_UID_ZERO\" ]; then\n    SERVER_USER=$(id -un)\n    return\n  fi\n\n  # If previous configuration (e.g. easy-configuration, option 1) requested a\n  # specific SERVER_USER, then let's go with that.\n  if [ ! -z \"${DESIRED_SERVER_USER:-}\" ] ; then\n    SERVER_USER=\"$DESIRED_SERVER_USER\"\n    CREATE_SERVER_USER=\"yes\"\n    ADD_SUDO_USER_TO_SERVER_GROUP=\"no\"\n    return\n  fi\n\n  # If we got this far, then we need to ask.\n  SERVER_USER=$(prompt \"Local user account to run server under:\" sandstorm)\n\n  while [ \"$SERVER_USER\" = root ]; do\n    echo \"Sandstorm cannot run as root!\"\n    SERVER_USER=$(prompt \"Local user account to run server under:\" sandstorm)\n  done\n}\n\ncreate_server_user_if_needed() {\n  # Find out if the user exists. If so, then we're done!\n  if id \"$SERVER_USER\" &gt; /dev/null 2&gt;&amp;1; then\n    return\n  fi\n\n  # Since the server user does not exist, we create it (asking for\n  # permission if necessary).\n  if [ \"yes\" != \"${CREATE_SERVER_USER:-}\" ] ; then\n    if prompt-yesno \"User account '$SERVER_USER' doesn't exist. Create it?\" yes ; then\n      CREATE_SERVER_USER=yes\n    fi\n  fi\n\n  # If people don't want us to create it, then let's bail now.\n  if [ \"yes\" != \"${CREATE_SERVER_USER:-}\" ] ; then\n    return\n  fi\n\n  # OK! Let's proceed.\n  #\n  # To create the server user, we first try `useradd`, which is widely available on most\n  # distros. If that isn't available, it's likely we're running on a busybox based system.\n  # busybox provides an `adduser` applet, so if that command links to the busybox binary\n  # we it instead.\n  #\n  # Note that debian provides an `adduser` command as well, but its usage is different.\n  # useradd is available on debian anyway, so we'll end up using that.\n  if which useradd &gt;/dev/null; then\n    # Per the man page for useradd, USERGROUPS_ENAB in /etc/login.defs controls if useradd\n    # will automatically create a group for this user (the new group would have the same\n    # name as the new user). On systems such as OpenSuSE where that flag is set to false\n    # by default, or on systems where the administrator has personally tuned that flag,\n    # we need to provide --user-group to useradd so that it creates the group.\n    useradd --system --user-group \"$SERVER_USER\"\n  elif [ \"$(basename $(readlink $(which adduser)))\" = busybox ]; then\n    # With busybox we need to separately create the user's group.\n    addgroup -S \"$SERVER_USER\"\n    adduser -S -G \"$SERVER_USER\" \"$SERVER_USER\"\n  else\n    fail \"E_NO_USERADD\" \\\n      \"Couldn't find a command with which to add a user (either useradd or busybox).\"\n  fi\n\n  echo \"Note: Sandstorm's storage will only be accessible to the group '$SERVER_USER'.\"\n\n  # If SUDO_USER is non-empty, we let the user opt in to adding\n  # themselves to the storage group.\n\n  # The easy-install opts out of this flow by setting\n  # ADD_SUDO_USER_TO_SERVER_GROUP=no.\n  if [ \"no\" = \"${ADD_SUDO_USER_TO_SERVER_GROUP:-}\" ] ; then\n    return\n  fi\n\n  if [ -n \"${SUDO_USER:-}\" ]; then\n    if prompt-yesno \"Add user '$SUDO_USER' to group '$SERVER_USER'?\" no ; then\n      usermod -a -G \"$SERVER_USER\" \"$SUDO_USER\"\n      echo \"Added. Don't forget that group changes only apply at next login.\"\n    fi\n  fi\n}\n\nchoose_port() {\n  # If there already is a PORT chosen, then don't bother asking.\n  if [ ! -z \"${PORT:-}\" ] ; then\n    return\n  fi\n\n  PORT=$(prompt-numeric \"Server main HTTP port:\" $DEFAULT_PORT)\n\n  while [ \"$PORT\" -lt 1024 ]; do\n    echo \"Ports below 1024 require root privileges. Sandstorm does not run as root.\"\n    echo \"To use port $PORT, you'll need to set up a reverse proxy like nginx that \"\n    echo \"forwards to the internal higher-numbered port. The Sandstorm git repo \"\n    echo \"contains an example nginx config for this.\"\n    PORT=$(prompt-numeric \"Server main HTTP port:\" $DEFAULT_PORT)\n  done\n}\n\nchoose_mongo_port() {\n  # If there is already a MONGO_PORT chosen, then don't bother asking.\n  if [ ! -z \"${MONGO_PORT:-}\" ] ; then\n    return\n  fi\n\n  # If the port we'll bind is less than 1024, then default to MONGO_PORT of 6081 because\n  # mongo can't listen on root-owned ports in our configuration.\n  local DEFAULT_MONGO_PORT=\"$((PORT + 1))\"\n  if [ \"$PORT\" -lt 1024 ] ; then\n    DEFAULT_MONGO_PORT=\"6081\"\n  fi\n\n  MONGO_PORT=$(prompt-numeric \"Database port (choose any unused port):\" \"${DEFAULT_MONGO_PORT}\")\n}\n\nchoose_external_or_internal() {\n  # Figure out if we want to listen on internal vs. external interfaces.\n  if [ \"yes\" != \"$USE_EXTERNAL_INTERFACE\" ]; then\n    if prompt-yesno \"Expose to localhost only?\" yes ; then\n      USE_EXTERNAL_INTERFACE=\"no\"\n    else\n      USE_EXTERNAL_INTERFACE=\"yes\"\n    fi\n  fi\n}\n\nconfigure_auto_updates() {\n  # If UPDATE_CHANNEL is non-empty, then skip this.\n  if [ -n \"${UPDATE_CHANNEL:-}\" ]; then\n    return\n  fi\n\n  # Otherwise, ask!\n  if prompt-yesno \"Automatically keep Sandstorm updated?\" yes; then\n    UPDATE_CHANNEL=$DEFAULT_UPDATE_CHANNEL\n  else\n    UPDATE_CHANNEL=none\n  fi\n}\n\nconfigure_dev_accounts() {\n  # If ALLOW_DEV_ACCOUNTS is set to yes already, then skip this.\n  if [ \"yes\" = \"${ALLOW_DEV_ACCOUNTS}\" ]; then\n    return\n  fi\n\n  # If USE_EXTERNAL_INTERFACE is set to yes, then skip this, because\n  # dev accounts on the Internet would be crazy.\n  if [ \"yes\" = \"${USE_EXTERNAL_INTERFACE}\" ] ; then\n    return\n  fi\n\n  echo \"Sandstorm supports 'dev accounts', a feature that lets anyone log in\"\n  echo \"as admin and other sample users to a Sandstorm server. We recommend\"\n  echo \"it for app development, and absolutely do not recommend it for\"\n  echo \"a server on the public Internet.\"\n\n  if prompt-yesno \"Enable dev accounts?\" \"yes\" ; then\n    ALLOW_DEV_ACCOUNTS=yes\n  fi\n}\n\nsave_config() {\n  writeConfig SERVER_USER PORT MONGO_PORT BIND_IP BASE_URL WILDCARD_HOST UPDATE_CHANNEL ALLOW_DEV_ACCOUNTS \nSMTP_LISTEN_PORT &gt; sandstorm.conf\n  if [ \"yes\" = \"$SANDCATS_SUCCESSFUL\" ] ; then\n    writeConfig SANDCATS_BASE_DOMAIN &gt;&gt; sandstorm.conf\n  fi\n  if [ \"yes\" = \"$USE_HTTPS\" ] ; then\n    writeConfig HTTPS_PORT &gt;&gt; sandstorm.conf\n  fi\n\n  echo\n  echo \"Config written to $PWD/sandstorm.conf.\"\n}\n\ndownload_latest_bundle_and_extract_if_needed() {\n  # If BUNDLE_FILE is non-empty, we were provided a bundle file, so we\n  # can skip downloading one.\n  if [ -n \"${BUNDLE_FILE:-}\" ]; then\n    return\n  fi\n\n  echo \"Finding latest build for $DEFAULT_UPDATE_CHANNEL channel...\"\n  # NOTE: The type is install_v2. We use the \"type\" value when calculating how many people attempted\n  # to do a Sandstorm install. We had to stop using \"install\" because vagrant-spk happens to use\n  # &amp;type=install during situations that we do not want to categorize as an attempt by a human to\n  # install Sandstorm.\n  BUILD=\"$(curl -A \"$CURL_USER_AGENT\" -fs \n\"https://install.sandstorm.io/$DEFAULT_UPDATE_CHANNEL?from=0&amp;type=install_v2\")\"\n  BUILD_DIR=\"sandstorm-${BUILD}\"\n\n  if [[ ! \"$BUILD\" =~ ^[0-9]+$ ]]; then\n    fail \"E_INVALID_BUILD_NUM\" \"Server returned invalid build number: $BUILD\"\n  fi\n\n  do-download() {\n    rm -rf \"${BUILD_DIR}\"\n    WORK_DIR=\"$(mktemp -d ./sandstorm-installer.XXXXXXXXXX)\"\n    local URL=\"https://dl.sandstorm.io/sandstorm-$BUILD.tar.xz\"\n    echo \"Downloading: $URL\"\n    retryable_curl \"$URL\" \"$WORK_DIR/sandstorm-$BUILD.tar.xz\"\n    retryable_curl \"$URL.sig\" \"$WORK_DIR/sandstorm-$BUILD.tar.xz.sig\"\n\n    if which gpg &gt; /dev/null; then\n      export GNUPGHOME=\"$WORK_DIR/.gnupg\"\n      mkdir -m 0700 -p \"$GNUPGHOME\"\n\n      # Regenerate with: gpg --armor --export 160D2D577518B58D94C9800B63F227499DA8CCBD\n      gpg --dearmor &gt; \"$WORK_DIR/sandstorm-keyring.gpg\" &lt;&lt; __EOF__\n-----BEGIN PGP PUBLIC KEY BLOCK-----\nVersion: GnuPG v1\n\nmQENBFX8ypkBCAC8sjX5yZqKdW8nY7aE/GpVeS+qSCbpYSJwixYNFXbz3MQihR3S\nsuvg5uw1KyuQb23c0LwirfxazVf7txKhQNaNU3ek62LG3wcGeBrvQGsIUMbkatay\n/163CLeVWfSK1Z4pFc4dhdjXYSOz0oZxd7Mp78crBbGKmyn7PtzdAqt+XfEXNuee\ncDbx++P57n5s5xc5fQWznt333IMgmgTREGUROfh4kL376rFAS208XIywJlUVkoKM\nkIzgcjevFGwYKdsLigHXCDp9toQHl8oPjFV+RE8Br8ciJlMp9CqCfHGwj0Orxasc\ne9moLqqUc+iKdg9bQfuAbJ/jFNhGmV/CVv9tABEBAAG0LlNhbmRzdG9ybS5pbyAo\ncmVsZWFzZXMpIDxzdXBwb3J0QHNhbmRzdG9ybS5pbz6JATgEEwECACIFAlX8ypkC\nGwMGCwkIBwMCBhUIAgkKCwQWAgMBAh4BAheAAAoJEGPyJ0mdqMy91bYH/iTg9qbw\nG3th57Yf70NtyMJE3UBFDYDNAgT45UBEHoHhQM5cdFu/EIHggOKl/A2zL19Nh555\n5F5o3jiJChQ0cvpoVnDdA5lRKD9iK6hzAba9fCVAx/od1PULQP7KV+uHTQuclSFO\nDBvpgT8bMY9LmlpTl+l2lvYd+c50w3jZMFwh8JrJYAc3X0kBfVEywVZkjH8Nw5nD\nv/j5Of3XXfEg84tNyWSYUMrYVORJyfHtA9e3JXNv5BMxH73AVLnyCJhCaodQsC6Z\nhFkHUvvRb58ZqKXMtLYTd/8XLIvpkgRNX6EHWDslJh3BaBwHSuqDNssh1TW5xPjA\n9vkPDzeZfLkuxpy5AQ0EVfzKmQEIANyi22M/3KhkghsPA6Rpha1lx6JJCb4p7E21\ny82OGFUwcMpZkSgh1lARgp/Mvc2CHhAXi6NkGbgYc1q5rgARSvim2EMZNQOEqRb9\nteEeI3w7Nz8Q/WoWck9WaXg8EdELtBOXYgVEirVddUl6ftUvCeBh3hE2Y/CLQSXL\nCYXdQ2/MN6xV8tepuWOu0aPxxPUNea9ceDNZ8/CXEL32pzv9SUX/3KgSnFTzmxNP\nthzXGuaAQGMZRu3cdTSeK9UUX4L3lxv7p0nE/2K18MU3FayTJqspfUCc4BgHZRMN\nsh+2/YNfJgi0uWex1WnU94ZIp4A0uic54bU1ZECSwxg81KHaEEkAEQEAAYkBHwQY\nAQIACQUCVfzKmQIbDAAKCRBj8idJnajMvZgPB/0THpTPnfsYNkwQrBsrTq413ZTF\nJmVyeZ9xnGDImOdyHhGLlnLC1YEnaNUVEyMKifya4TF2utrLrsMT9TC/dWvFsYlJ\noMcUpaSlrFoAoPp3pdOGCIRYNhWGHoxy0Ti1WAa/6A+GoHJpUEz85/jD4vjgYlCX\nZFW1Pji9PbdIZFZQR4FyYBkkZOUq6yyTNR0syQPVy3EsPVvXzszm2zV/1YjGymgj\nMKeYR9+VU+PlFAY9wwLWLTFeSzxTyVjbPwF5bWHV32GM8g0/NgA6a1JLL40v7pqf\nuYvFk2KJpo3gZNGJ72gLkSzie7Eu1/V67JIG9TwfrJUEj8Uwd5zPv1MOqfWl\n=OiS5\n-----END PGP PUBLIC KEY BLOCK-----\n__EOF__\n\n      if gpg --no-default-keyring --keyring $WORK_DIR/sandstorm-keyring.gpg --status-fd 1 \\\n             --verify $WORK_DIR/sandstorm-$BUILD.tar.xz{.sig,} 2&gt;/dev/null | \\\n          grep -q '^\\[GNUPG:\\] VALIDSIG 160D2D577518B58D94C9800B63F227499DA8CCBD '; then\n        echo \"GPG signature is valid.\"\n      else\n        rm -rf sandstorm-$BUILD\n        fail \"E_INVALID_GPG_SIG\" \"GPG signature is NOT valid! Please report to security@sandstorm.io \nimmediately!\"\n      fi\n\n      unset GNUPGHOME\n    else\n      echo \"WARNING: gpg not installed; not verifying signatures (but it's HTTPS so you're probably fine)\" &gt;&amp;2\n    fi\n\n    tar Jxof \"$WORK_DIR/sandstorm-$BUILD.tar.xz\"\n    rm -rf \"$WORK_DIR\"\n\n    if [ ! -e \"$BUILD_DIR\" ]; then\n      fail \"E_BAD_PACKAGE\" \"Bad package -- did not contain $BUILD_DIR directory.\"\n    fi\n\n    # We used to reject packages older than 30 days on the assumption the package would definitely\n    # be updated more often than that. For about six years the existence of this check was the main\n    # thing that drove me (Kenton) to do a release every month, although I occasionally forgot which\n    # would temporarily block new installs. Surprisingly (to me, at least), whenever this happend,\n    # people would actually notice and complain within a day or two -- people were apparently\n    # still installing Sandstorm regularly.\n    #\n    # As of Feb 2023, though, I think it's time to retire this check and end the monthly update\n    # schedule, for several reasons:\n    # - In 2022, the majority of months saw no actual changes at all.\n    # - Ian, who had been the most active maintainer, is now focusing his efforts on a new\n    #   implementation called Tempest. So 2023 is likely to see even fewer changes.\n    # - It's no longer possible to update the Meteor dependency, because newer versions of Meteor\n    #   no longer support the ancient version of Mongo we're stuck on (2.6), and writing automation\n    #   to update everyone's Mongo instances automatically without breaking anyone is too large\n    #   a project for anyone to volunteer for. Since almost all of Sandstorm's dependencies stem\n    #   from Meteor, trying to update dependencies on a monthly basis has become futile, as the\n    #   pinned Meteor version holds everything else back.\n    # - I just have too much to do, and although releases are not a whole lot of work, it feels\n    #   like one more thing on the pile.\n    #\n    # I'm still happy to push releases when there are interesting changes.\n#    if [ ! -e \"$BUILD_DIR/buildstamp\" ] || \\\n#       [ $(stat -c %Y \"$BUILD_DIR/buildstamp\") -lt $(( $(date +%s) - 30*24*60*60 )) ]; then\n#      rm -rf \"$BUILD_DIR\"\n#      fail \"E_PKG_STALE\" \"The downloaded package seems to be more than a month old. Please verify that your\" \n\\\n#           \"computer's clock is correct and try again. It could also be that an attacker is\" \\\n#           \"trying to trick you into installing an old version. Please contact\" \\\n#           \"security@sandstorm.io if the problem persists.\"\n#    fi\n  }\n\n  if [ -e $BUILD_DIR ]; then\n    echo \"$BUILD_DIR is already present. Should I use it or re-download?\"\n    if ! prompt-yesno \"Use existing copy?\" yes; then\n      do-download\n    fi\n  else\n    do-download\n  fi\n}\n\nextract_bundle_if_provided() {\n  # If BUNDLE_FILE is empty, it means that we have no bundle file to extract,\n  # so we can skip downloading it.\n  if [ -z \"${BUNDLE_FILE:-}\" ]; then\n    return\n  fi\n\n  # Use the specified local bundle, which we already validated earlier.\n\n  if [ $BUILD = 0 ]; then\n    BUILD_DIR=sandstorm-custom.$(date +'%Y-%m-%d_%H-%M-%S')\n  else\n    BUILD_DIR=sandstorm-$BUILD\n  fi\n\n  rm -rf \"$BUILD_DIR\"\n  mkdir \"$BUILD_DIR\"\n  (cd \"$BUILD_DIR\" &amp;&amp; tar Jxof \"$BUNDLE_FILE\" --strip=1)\n}\n\nmake_runtime_directories() {\n  GROUP=$(id -g $SERVER_USER)\n\n  # Make var directories.\n  mkdir -p var/{log,pid,mongo} var/sandstorm/{apps,grains,downloads}\n\n  # Create useful symlinks.\n  ln -sfT $BUILD_DIR latest\n  ln -sfT latest/sandstorm sandstorm\n}\n\nset_permissions() {\n  # If not running the installer as root, we can't do all the\n  # permissions stuff we want to.\n  if [ \"yes\" != \"$CURRENTLY_UID_ZERO\" ]; then\n    return\n  fi\n\n  local ADMIN_TOKEN_PATH=\n  if [ -e \"${ADMIN_TOKEN_PATH}\" ] ; then\n    ADMIN_TOKEN_PATH=\"var/sandstorm/adminToken\"\n  fi\n\n  # Set ownership of files.  We want the dirs to be root:sandstorm but the contents to be\n  # sandstorm:sandstorm.\n  chown -R $SERVER_USER:$GROUP var/{log,pid,mongo} var/sandstorm/{apps,grains,downloads} $ADMIN_TOKEN_PATH\n  chown root:$GROUP var/{log,pid,mongo,sandstorm} var/sandstorm/{apps,grains,downloads} $ADMIN_TOKEN_PATH\n  chmod -R g=rwX,o= var/{log,pid,mongo,sandstorm} var/sandstorm/{apps,grains,downloads} $ADMIN_TOKEN_PATH\n}\n\ninstall_sandstorm_symlinks() {\n  # If not running the installer as root, we can't modify\n  # /usr/local/bin, so we have to skip this.\n  if [ \"yes\" != \"$CURRENTLY_UID_ZERO\" ]; then\n    return\n  fi\n\n  local FAILED_TO_WRITE_SYMLINK=\"no\"\n\n  # Install tools.\n  ln -sfT $PWD/sandstorm /usr/local/bin/sandstorm || FAILED_TO_WRITE_SYMLINK=yes\n  ln -sfT $PWD/sandstorm /usr/local/bin/spk || FAILED_TO_WRITE_SYMLINK=yes\n\n  # If /usr/local/bin is not actually writeable, even though we are root, then bail on this for now.\n  # That can happen on e.g. CoreOS; see https://github.com/sandstorm-io/sandstorm/issues/1660\n  # the bash \"-w\" does not detect read-only mounts, so we use a behavior check above.\n  if [ \"${FAILED_TO_WRITE_SYMLINK}\" = \"yes\" ] ; then\n    echo \"\"\n    echo \"*** WARNING: /usr/local/bin was not writeable. To run sandstorm or spk manually, use:\"\n    echo \" - $PWD/sandstorm\"\n    echo \" - $PWD/sandstorm spk\"\n    echo \"\"\n    return\n  fi\n\n}\n\nask_about_starting_at_boot() {\n  # Starting Sandstorm at boot cannot work if we are not root by this point.\n  if [ \"$CURRENTLY_UID_ZERO\" != \"yes\" ] ; then\n    START_AT_BOOT=\"no\"\n  fi\n\n  # If we already know if we want to start the thing at boot, we can skip asking.\n  if [ ! -z \"${START_AT_BOOT:-}\" ] ; then\n    return\n  fi\n\n  if prompt-yesno \"Start sandstorm at system boot (using $INIT_SYSTEM)?\" yes; then\n    START_AT_BOOT=yes\n  fi\n}\n\nconfigure_start_at_boot_if_desired() {\n  SANDSTORM_NEEDS_TO_BE_STARTED=\"yes\"\n\n  # If the user doesn't want us to start Sandstorm at boot, then we\n  # don't run anything in this function.\n  if [ \"yes\" != \"${START_AT_BOOT:-}\" ] ; then\n    return\n  fi\n\n  if [ \"systemd\" = \"${INIT_SYSTEM}\" ] ; then\n    configure_systemd_init_system\n    SANDSTORM_NEEDS_TO_BE_STARTED=no\n  elif [ \"sysvinit\" = \"${INIT_SYSTEM}\" ] ; then\n    configure_sysvinit_init_system\n    SANDSTORM_NEEDS_TO_BE_STARTED=no\n  else\n    echo \"Note: I don't know how to set up sandstorm to auto-run at startup on\"\n    echo \"  your system. :(\"\n    echo\n  fi\n}\n\nconfigure_systemd_init_system() {\n  # WARNING: This function should only be run if we already know\n  # systemd is the current init system. It relies on its caller to\n  # verify that.\n\n  local SYSTEMD_UNIT=\"sandstorm.service\"\n\n  # Stop Sandstorm if it is currently running.\n  if systemctl list-unit-files | grep -q $SYSTEMD_UNIT; then\n    systemctl stop sandstorm || true\n  fi\n\n  # the init.d logic simply overwrites the init script if it exists, adopt that here\n  for SYSTEMD_UNIT_PATH in /etc/systemd/system /run/systemd/system /usr/lib/systemd/system; do\n    if [ -e $SYSTEMD_UNIT_PATH/$SYSTEMD_UNIT ] ; then\n      rm $SYSTEMD_UNIT_PATH/$SYSTEMD_UNIT\n    fi\n  done\n\n  cat &gt; /etc/systemd/system/$SYSTEMD_UNIT &lt;&lt; __EOF__\n[Unit]\nDescription=Sandstorm server\nAfter=local-fs.target remote-fs.target network-online.target\nRequires=local-fs.target remote-fs.target\nWants=network-online.target\n\n[Service]\nType=forking\nExecStart=$PWD/sandstorm start\nExecStop=$PWD/sandstorm stop\n\n[Install]\nWantedBy=multi-user.target\n__EOF__\n  systemctl enable sandstorm\n  systemctl start sandstorm\n  STARTED_SANDSTORM=\"yes\"\n}\n\nconfigure_sysvinit_init_system() {\n  # WARNING: This function should only be run if we already know\n  # sysvinit is the current init system. It relies on its caller to\n  # verify that.\n\n  # Stop Sandstorm, since we don't know what its configuration is.\n  if [ -e /etc/init.d/sandstorm ] ; then\n    service sandstorm stop || true\n  fi\n\n  # Replace the init script with something that should definitely\n  # work.\n\n  cat &gt; /etc/init.d/sandstorm &lt;&lt; __EOF__\n#! /bin/bash\n### BEGIN INIT INFO\n# Provides:          sandstorm\n# Required-Start:    \\$local_fs \\$remote_fs \\$networking \\$syslog\n# Required-Stop:     \\$local_fs \\$remote_fs \\$networking \\$syslog\n# Default-Start:     2 3 4 5\n# Default-Stop:      0 1 6\n# Short-Description: starts Sandstorm personal cloud server\n### END INIT INFO\n\nDESC=\"Sandstorm server\"\nDAEMON=$PWD/sandstorm\n\n# The Sandstorm runner supports all the common init commands directly.\n# We use -a to set the program name to make help text look nicer.\n# This requires bash, though.\nexec -a \"service sandstorm\" \\$DAEMON \"\\$@\"\n__EOF__\n\n  # Mark as executable, and enable on boot.\n  chmod +x /etc/init.d/sandstorm\n  if [ \"$(which update-rc.d)\" != \"\" ]; then\n    update-rc.d sandstorm defaults\n  elif [ \"$(which rc-update)\" != \"\" ]; then\n    rc-update add sandstorm\n  else\n    echo \"WARNING: I couldn't figure out how to make the Sandstorm init script active on\" &gt;&amp;2\n    echo \"  your system; neither update-rc.d nor rc-update commands seem to exist. Sandstorm\" &gt;&amp;2\n    echo \"  will not start automatically at boot until you mark its init script active.\" &gt;&amp;2\n  fi\n\n  # Start it right now.\n  service sandstorm start\n  STARTED_SANDSTORM=\"yes\"\n}\n\ngenerate_admin_token() {\n  # If dev accounts are enabled, the user does not need an admin token.\n  if [ \"yes\" = \"${ALLOW_DEV_ACCOUNTS}\" ] ; then\n    return\n  fi\n\n  # Allow the person running the install.sh script to pre-generate an admin token, specified as an\n  # environment variable, so that they can ignore the output text of install.sh.\n  if [ ! -z \"${ADMIN_TOKEN:-}\" ] ; then\n    local TMPFILENAME=\"$(mktemp ./var/sandstorm/adminTokenTmp.XXXXXXXXXX)\"\n    echo -n \"$ADMIN_TOKEN\" &gt; \"$TMPFILENAME\"\n    local FILENAME=\"./var/sandstorm/adminToken\"\n    mv \"$TMPFILENAME\" \"$FILENAME\"\n    chmod 0640 \"$FILENAME\"\n    chgrp \"$SERVER_USER\" \"$FILENAME\"\n    return\n  fi\n\n  ADMIN_TOKEN=$(./sandstorm admin-token --quiet)\n}\n\nprint_success() {\n  echo \"\"\n  if [ \"yes\" = \"$SANDSTORM_NEEDS_TO_BE_STARTED\" ] ; then\n    echo \"Installation complete. To start your server now, run:\"\n    echo \"  $DIR/sandstorm start\"\n    echo \"Once that's done, visit this link to start using it:\"\n  else\n    echo -n \"Your server is now online! \"\n    echo \"Visit this link to start using it:\"\n  fi\n\n  echo \"\"\n\n  # If there is an admin token at this point, print an admin token URL.  Otherwise, don't. Note that\n  # when dev accounts are enabled, it is advantageous to not print an admin token URL.\n  if [ ! -z \"${ADMIN_TOKEN:-}\" ] ; then\n    echo \"  ${BASE_URL:-(unknown; bad config)}/setup/token/$ADMIN_TOKEN\"\n    echo \"\"\n    echo \"NOTE: This URL expires in 15 minutes. You can generate a new setup URL by running\"\n    echo \"'sudo sandstorm admin-token' from the command line.\"\n  else\n    echo \"  ${BASE_URL:-(unknown; bad config)}/\"\n  fi\n  if [ \"yes\" = \"${ALLOW_DEV_ACCOUNTS}\" ] ; then\n   echo \"\"\n   echo \"NOTE: Use the passwordless admin account called Alice for convenient dev login (since you have 'dev \naccounts' enabled).\"\n  fi\n  echo \"\"\n\n  echo\n  echo \"To learn how to control the server, run:\"\n  if [ \"yes\" = \"$CURRENTLY_UID_ZERO\" ] ; then\n    echo \"  sandstorm help\"\n  else\n    echo \"  $DIR/sandstorm help\"\n  fi\n}\n\nsandcats_provide_help() {\n  echo \"Sandcats.io is a free dynamic DNS service run by the Sandstorm development team.\"\n  echo \"\"\n  echo \"You can:\"\n  echo \"\"\n  echo \"* Read more about it at:\"\n  echo \"  https://docs.sandstorm.io/en/latest/administering/sandcats/\"\n  echo \"\"\n  echo \"* Recover access to a domain you once registered with sandcats\"\n  echo \"\"\n  echo \"* Just press enter to go to the previous question.\"\n  sandcats_recover_domain\n}\n\nsandcats_recover_domain() {\n  DESIRED_SANDCATS_NAME=$(prompt \"What Sandcats subdomain do you want to recover?\" \"none\")\n\n  # If the user wants none of our help, then go back to registration.\n  if [ \"none\" = \"$DESIRED_SANDCATS_NAME\" ] ; then\n    unset DESIRED_SANDCATS_NAME\n    sandcats_register_name\n    return\n  fi\n\n  # If the user gave us a hostname that contains a dot, tell them they need to re-enter it.\n  if [[ $DESIRED_SANDCATS_NAME =~ [.] ]] ; then\n    echo \"\"\n    echo \"You entered: $DESIRED_SANDCATS_NAME\"\n    echo \"\"\n    echo \"but this function just wants the name of your subdomain, not including any dot characters.\"\n    echo \"Please try again.\"\n    echo \"\"\n    sandcats_recover_domain\n    return\n  fi\n\n  echo \"OK. We will send a recovery token to the email address on file. Type no to abort.\"\n  OK_TO_CONTINUE=$(prompt \"OK to continue?\" \"yes\")\n  if [ \"no\" = \"$OK_TO_CONTINUE\" ] ; then\n    unset DESIRED_SANDCATS_NAME\n    sandcats_register_name\n    return\n  fi\n\n  # First, we attempt to send the user a domain recovery token.\n  local LOG_PATH=\"var/sandcats/sendrecoverytoken-log\"\n  touch \"$LOG_PATH\"\n  chmod 0640 \"$LOG_PATH\"\n  HTTP_STATUS=$(\n    dotdotdot_curl \\\n      --silent \\\n      --max-time 20 \\\n      $SANDCATS_CURL_PARAMS \\\n      -A \"$CURL_USER_AGENT\" \\\n      -X POST \\\n      --data-urlencode \"rawHostname=$DESIRED_SANDCATS_NAME\" \\\n      --output \"$LOG_PATH\" \\\n      -w '%{http_code}' \\\n      -H 'X-Sand: cats' \\\n      -H \"Accept: text/plain\" \\\n      \"${SANDCATS_API_BASE}/sendrecoverytoken\")\n\n  if [ \"200\" != \"$HTTP_STATUS\" ] ; then\n    error \"$(cat $LOG_PATH)\"\n    sandcats_recover_domain\n    return\n  fi\n\n  # Show the server's output, which presumably is some happy\n  # message.\n  cat \"$LOG_PATH\"\n  # Make sure that is on a line of its own.\n  echo ''\n  TOKEN=$(prompt \"Please enter the token that we sent to you by email.\" '')\n\n  # If the token is empty, then they just hit enter; take them to the start of help.\n  if [ -z \"$TOKEN\" ] ; then\n    error \"Empty tokens are not valid.\"\n    sandcats_recover_domain\n    return\n  fi\n\n  # Let's submit that token to the server's \"recover\" endpoint.\n  #\n  # This action registers the new key as the authoritative key for\n  # this hostname. It also sends an email to the user telling them\n  # that we changed the key they have on file.\n  local LOG_PATH=\"var/sandcats/recover-log\"\n  touch \"$LOG_PATH\"\n  chmod 0640 \"$LOG_PATH\"\n  HTTP_STATUS=$(\n      dotdotdot_curl \\\n      --silent \\\n      --max-time 20 \\\n      $SANDCATS_CURL_PARAMS \\\n      -A \"$CURL_USER_AGENT\" \\\n      -X POST \\\n      --data-urlencode \"rawHostname=$DESIRED_SANDCATS_NAME\" \\\n      --data-urlencode \"recoveryToken=$TOKEN\" \\\n      --output \"$LOG_PATH\" \\\n      -w '%{http_code}' \\\n      -H 'X-Sand: cats' \\\n      -H \"Accept: text/plain\" \\\n      --cert var/sandcats/id_rsa.private_combined \\\n      \"${SANDCATS_API_BASE}/recover\")\n\n  if [ \"200\" != \"$HTTP_STATUS\" ] ; then\n    error \"$(cat $LOG_PATH)\"\n    sandcats_recover_domain\n    return\n  fi\n\n  # Show the server's output, which presumably is some happy\n  # message.\n  cat \"$LOG_PATH\"\n  # Make sure that is on a line of its own.\n  echo ''\n\n  # Now we can do a call to /update, which we will do silently on the\n  # user's behalf. This uses the new key we registered (via /recover)\n  # and sets the IP address for this host in the sandcats.io DNS\n  # service.\n  local LOG_PATH=\"var/sandcats/update-log\"\n  touch \"$LOG_PATH\"\n  chmod 0640 \"$LOG_PATH\"\n  HTTP_STATUS=$(\n    dotdotdot_curl \\\n      --silent \\\n      --max-time 20 \\\n      $SANDCATS_CURL_PARAMS \\\n      -A \"$CURL_USER_AGENT\" \\\n      -X POST \\\n      --data-urlencode \"rawHostname=$DESIRED_SANDCATS_NAME\" \\\n      --output \"$LOG_PATH\" \\\n      -w '%{http_code}' \\\n      -H 'X-Sand: cats' \\\n      -H \"Accept: text/plain\" \\\n      --cert var/sandcats/id_rsa.private_combined \\\n      \"${SANDCATS_API_BASE}/update\")\n\n  if [ \"200\" != \"$HTTP_STATUS\" ] ; then\n    error \"$(cat $LOG_PATH)\"\n    sandcats_recover_domain\n    return\n  fi\n\n  # Show the server's happy message.\n  cat \"$LOG_PATH\"\n  # Make sure that is on a line of its own.\n  echo ''\n\n  SANDCATS_SUCCESSFUL=\"yes\"\n  SS_HOSTNAME=\"${DESIRED_SANDCATS_NAME}.${SANDCATS_BASE_DOMAIN}\"\n  USE_EXTERNAL_INTERFACE=\"yes\"\n  USE_HTTPS=\"yes\"\n  echo \"Congratulations! You're all configured to use ${DESIRED_SANDCATS_NAME}.${SANDCATS_BASE_DOMAIN}.\"\n  echo \"Your credentials to use it are in $(readlink -f var/sandcats); consider making a backup.\"\n}\n\nsandcats_registerreserved() {\n  echo \"Registering your pre-reserved domain.\"\n  local LOG_PATH\n  LOG_PATH=\"var/sandcats/registerreserved-log\"\n  touch \"$LOG_PATH\"\n  chmod 0640 \"$LOG_PATH\"\n  HTTP_STATUS=$(\n    dotdotdot_curl \\\n      --silent \\\n      --max-time 20 \\\n      $SANDCATS_CURL_PARAMS \\\n      -A \"$CURL_USER_AGENT\" \\\n      -X POST \\\n      --data-urlencode \"domainReservationToken=$SANDCATS_DOMAIN_RESERVATION_TOKEN\" \\\n      --data-urlencode \"rawHostname=$DESIRED_SANDCATS_NAME\" \\\n      --output \"$LOG_PATH\" \\\n      -w '%{http_code}' \\\n      -H 'X-Sand: cats' \\\n      -H \"Accept: text/plain\" \\\n      --cert var/sandcats/id_rsa.private_combined \\\n      \"${SANDCATS_API_BASE}/registerreserved\")\n\n  if [ \"200\" = \"$HTTP_STATUS\" ]\n  then\n    # Show the server's output, which presumably is some happy\n    # message.\n    cat \"$LOG_PATH\"\n    # Make sure that is on a line of its own.\n    echo ''\n    # Set these global variables to inform the installer down the\n    # road.\n    SS_HOSTNAME=\"${DESIRED_SANDCATS_NAME}.${SANDCATS_BASE_DOMAIN}\"\n    USE_EXTERNAL_INTERFACE=\"yes\"\n    USE_HTTPS=\"yes\"\n    SANDCATS_SUCCESSFUL=\"yes\"\n    echo \"Congratulations! We have registered your ${DESIRED_SANDCATS_NAME}.${SANDCATS_BASE_DOMAIN} name.\"\n    echo \"Your credentials to use it are in $(readlink -f var/sandcats); consider making a backup.\"\n  else\n    # Show the server's output, and bail out.\n    #\n    # TODO(soon): Wait 1 minute in case the sandcats.io service had a brief hiccup, and retry (let's\n    # say) 5 times.\n    fail \"E_SANDCATS_REGISTER_RESERVED_SRV_FAIL\" \"$(cat \"$LOG_PATH\")\"\n  fi\n}\n\nsandcats_register_name() {\n  # We allow environment variables to override some details of the\n  # Sandcats service, so that during development, we can test against\n  # a non-production Sandcats service.\n  SANDCATS_API_BASE=\"${OVERRIDE_SANDCATS_API_BASE:-https://sandcats.io}\"\n  SANDCATS_CURL_PARAMS=\"${OVERRIDE_SANDCATS_CURL_PARAMS:-}\"\n\n  # If there is a SANDCATS_DOMAIN_RESERVATION_TOKEN provided, then we call a different function to\n  # do the work.\n  if [ ! -z \"${SANDCATS_DOMAIN_RESERVATION_TOKEN:-}\" ] ; then\n    sandcats_registerreserved\n    return\n  fi\n\n  if [ -z \"${DESIRED_SANDCATS_NAME:-}\" ] ; then\n    echo \"Choose your desired Sandcats subdomain (alphanumeric, max 20 characters).\"\n    echo \"Type the word none to skip this step, or help for help.\"\n    DESIRED_SANDCATS_NAME=$(prompt \"What *.${SANDCATS_BASE_DOMAIN} subdomain would you like?\" '')\n  fi\n\n  # If they just press enter, insist that they type either the word\n  # \"none\" or provide a name they want to register.\n  if [ -z \"$DESIRED_SANDCATS_NAME\" ] ; then\n    sandcats_register_name\n    return\n  fi\n\n  # If the user really wants none of our sandcats help, then bail out.\n  if [ \"none\" = \"$DESIRED_SANDCATS_NAME\" ] ; then\n    return\n  fi\n\n  # If the user wants help, offer help.\n  if [ \"help\" = \"$DESIRED_SANDCATS_NAME\" ] ; then\n    sandcats_provide_help\n    return\n  fi\n\n  # Validate the client-side, to avoid problems, against a slightly\n  # less rigorous regex than the server is using.\n  if ! [[ $DESIRED_SANDCATS_NAME =~ ^[0-9a-zA-Z-]{1,20}$ ]] ; then\n    unset DESIRED_SANDCATS_NAME\n    sandcats_register_name\n    return\n  fi\n\n  # Ask them for their email address, since we use that as part of Sandcats\n  # registration.\n  if [ -z \"${SANDCATS_REGISTRATION_EMAIL:-}\" ]; then\n    echo \"We need your email on file so we can help you recover your domain if you lose access. No spam.\"\n    SANDCATS_REGISTRATION_EMAIL=$(prompt \"Enter your email address:\" \"\")\n\n    # If the user fails to enter an email address, bail out.\n    while [ \"\" = \"$SANDCATS_REGISTRATION_EMAIL\" ] ; do\n      echo \"For the DNS service, we really do need an email address. To cancel, type: Ctrl-C.\"\n      SANDCATS_REGISTRATION_EMAIL=$(prompt \"Enter your email address:\" \"\")\n    done\n  fi\n\n  echo \"Registering your domain.\"\n  local LOG_PATH\n  LOG_PATH=\"var/sandcats/register-log\"\n  touch \"$LOG_PATH\"\n  chmod 0640 \"$LOG_PATH\"\n  HTTP_STATUS=$(\n    dotdotdot_curl \\\n      --silent \\\n      --max-time 20 \\\n      $SANDCATS_CURL_PARAMS \\\n      -A \"$CURL_USER_AGENT\" \\\n      -X POST \\\n      --data-urlencode \"rawHostname=$DESIRED_SANDCATS_NAME\" \\\n      --data-urlencode \"email=$SANDCATS_REGISTRATION_EMAIL\" \\\n      --output \"$LOG_PATH\" \\\n      -w '%{http_code}' \\\n      -H 'X-Sand: cats' \\\n      -H \"Accept: text/plain\" \\\n      --cert var/sandcats/id_rsa.private_combined \\\n      \"${SANDCATS_API_BASE}/register\")\n\n  if [ \"200\" = \"$HTTP_STATUS\" ]\n  then\n    # Show the server's output, which presumably is some happy\n    # message.\n    cat \"$LOG_PATH\"\n    # Make sure that is on a line of its own.\n    echo ''\n    # Set these global variables to inform the installer down the\n    # road.\n    SS_HOSTNAME=\"${DESIRED_SANDCATS_NAME}.${SANDCATS_BASE_DOMAIN}\"\n    USE_EXTERNAL_INTERFACE=\"yes\"\n    USE_HTTPS=\"yes\"\n    SANDCATS_SUCCESSFUL=\"yes\"\n    echo \"Congratulations! We have registered your ${DESIRED_SANDCATS_NAME}.${SANDCATS_BASE_DOMAIN} name.\"\n    echo \"Your credentials to use it are in $(readlink -f var/sandcats); consider making a backup.\"\n  else\n    # Show the server's output, and re-run this function.\n    error \"$(cat \"$LOG_PATH\")\"\n    unset DESIRED_SANDCATS_NAME\n    unset SANDCATS_REGISTRATION_EMAIL\n    sandcats_register_name\n    return\n  fi\n}\n\nwait_for_server_bind_to_its_port() {\n  # If we haven't started Sandstorm ourselves, it's not sensible to expect it to be listening.\n  if [ \"yes\" != \"${STARTED_SANDSTORM}\" ] ; then\n    return\n  fi\n\n  # For sandcats HTTPS, we have to generate the initial non-SNI key before Sandstorm binds to port\n  # 443. So we let the user know it could be slow. For all users, using the admin token requires\n  # that the server has started.\n  local PORT_TO_CHECK=\"${HTTPS_PORT:-$PORT}\"\n  echo -n \"Your server is coming online. Waiting up to 90 seconds...\"\n  local ONLINE_YET=\"no\"\n  for waited_n_seconds in $(seq 0 89); do\n    is_port_bound \"${BIND_IP}\" \"${PORT_TO_CHECK}\" &amp;&amp; ONLINE_YET=\"yes\"\n    if [ \"$ONLINE_YET\" == \"yes\" ] ; then\n      echo ''\n      break\n    fi\n    echo -n \".\"\n    sleep 1\n  done\n\n  # One last check before we bail out.\n  is_port_bound \"${BIND_IP}\" \"${PORT_TO_CHECK}\" &amp;&amp; ONLINE_YET=\"yes\"\n\n  if [ \"$ONLINE_YET\" == \"yes\" ]; then\n    return\n  else\n    fail \"E_NEVER_LISTENED\" \"Your server never started listening.\"\n  fi\n}\n\nsandcats_generate_keys() {\n    # The Sandcats service places its authentication files in $DIR/var/sandcats.\n    if [ -f var/sandcats/id_rsa.private_combined ] ; then\n        return\n    fi\n\n    # The openssl key generation process can take a few seconds, so we\n    # print a ... while that happens.\n    echo -n '...'\n\n    # We are already in $DIR. It's important to make it mode 0700\n    # because we store TLS client authentication keys here.\n    mkdir -p -m 0700 var/sandcats\n    chmod 0700 var/sandcats\n\n    # If we are root, we must chown the Sandcats configuration\n    # directory to the user that will be running Sandstorm.\n    if [ \"yes\" = \"$CURRENTLY_UID_ZERO\" ] ; then\n        chown \"$SERVER_USER\":\"$SERVER_USER\" var/sandcats\n    fi\n\n    # Generate key for client certificate. OpenSSL will read from\n    # /dev/urandom by default, so this won't block. We abuse the ``\n    # operator so we can have inline comments in a multi-line command.\n    openssl \\\n        req `# Invoke OpenSSL's PKCS#10 X.509 bits.` \\\n        -new `# Create a new certificate/request.` \\\n        -newkey rsa:4096 `# Create a new RSA key of length 4096 bits.` \\\n        -days 3650 `# Make the self-signed cert valid for 10 years.` \\\n        -nodes `# no DES -- that is, do not encrypt the key at rest.` \\\n        -x509 `# Output a certificate, rather than a signing request.` \\\n        `# Sandcats ignores the subject in the certificate; use` \\\n        `# OpenSSL defaults.` \\\n        -subj \"/C=AU/ST=Some-State/O=Internet Widgits Pty Ltd\" \\\n        -keyout var/sandcats/id_rsa `# Store the resulting RSA private key in id_rsa` \\\n        -out var/sandcats/id_rsa.pub `# Store the resulting certificate in id_rsa.pub` \\\n        2&gt;/dev/null `# Silence the progress output.`\n\n    # We combine these two things into one glorious all-inclusive file\n    # for the `curl` command. It is just as private as id_rsa.\n    cat var/sandcats/id_rsa var/sandcats/id_rsa.pub &gt; var/sandcats/id_rsa.private_combined\n\n    # Set filesystem permissions, in case the files get copied\n    # into the wrong place later.\n    chmod 0640 var/sandcats/id_rsa var/sandcats/id_rsa.pub var/sandcats/id_rsa.private_combined\n\n    # If we are root, make sure the files are owned by the\n    # $SERVER_USER. This way, Sandstorm can actually read them.\n    if [ \"yes\" = \"$CURRENTLY_UID_ZERO\" ] ; then\n        chown \"$SERVER_USER\":\"$SERVER_USER\" var/sandcats/id_rsa{,.pub,.private_combined}\n    fi\n\n    # Go to the start of the line, before the \"...\" that we\n    # left on the screen, allowing future echo statements to\n    # overwrite it.\n    echo -ne '\\r'\n}\n\nconfigure_https() {\n  if [ \"yes\" != \"${USE_HTTPS}\" ] ; then\n    return\n  fi\n\n  echo\n  echo \"Now we're going to fetch a TLS certificate using Let's Encrypt. This is a free\"\n  echo \"service provided by the nonprofit Electronic Frontier Foundation. By using this\"\n  echo \"service, you agree to be bound by the subscriber agreement, found here:\"\n  echo \"  https://letsencrypt.org/repository/#let-s-encrypt-subscriber-agreement\"\n  echo \"If you do not agree, please press ctrl+C now to cancel installation.\"\n  echo\n\n  if [ -z \"${ACME_EMAIL:-}\" ]; then\n    echo \"You must provide an email address, which will be shared with Let's Encrypt.\"\n    ACME_EMAIL=\"$(prompt \"Your email address for Let's Encrypt:\" \"${SANDCATS_REGISTRATION_EMAIL:-}\")\"\n  fi\n\n  $DIR/sandstorm create-acme-account \"$ACME_EMAIL\" --accept-terms ||\n      fail \"E_CREATE_ACME_ACCOUNT\" \"Failed to create Let's Encrypt account.\"\n\n  echo \"Your Let's Encrypt account has been created. Now we'll fetch a certificate!\"\n  $DIR/sandstorm renew-certificate ||\n      fail \"E_FETCH_CERTIFICATE\" \"Failed to fetch certificate.\"\n}\n\n# Now that the steps exist as functions, run them in an order that\n# would result in a working install.\nhandle_args \"$@\"\nset_umask\nassert_on_terminal\nassert_linux_x86_64\nassert_usable_kernel\ndetect_current_uid\nassert_dependencies\nassert_valid_bundle_file\ndetect_init_system\nchoose_install_mode\nmaybe_enable_userns_sysctl\nchoose_external_or_internal\nchoose_install_dir\nchoose_smtp_port\nload_existing_settings\nchoose_server_user_if_needed\ncreate_server_user_if_needed\nconfigure_auto_updates\nconfigure_dev_accounts\nconfigure_hostnames\nsave_config\ndownload_latest_bundle_and_extract_if_needed\nextract_bundle_if_provided\nmake_runtime_directories\ngenerate_admin_token\nset_permissions\ninstall_sandstorm_symlinks\nask_about_starting_at_boot\nconfigure_start_at_boot_if_desired\nwait_for_server_bind_to_its_port\nconfigure_https\nprint_success\n}\n\n# Now that we know the whole script has downloaded, run it.\n_ \"$0\" \"$@\"\n</code></pre>"},{"location":"examples/raw.githubusercontent.com.fb/","title":"/nvm-sh/nvm/v0.40.1/install.sh","text":""},{"location":"examples/raw.githubusercontent.com.fb/#description","title":"Description","text":"<ul> <li>run <code>curl -s https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.1/install.sh | bash</code> to install nvm Node Version Manager</li> <li>cf https://github.com/nvm-sh/nvm </li> </ul>"},{"location":"examples/raw.githubusercontent.com.fb/#stats","title":"Stats","text":"<pre><code>-------------------------------------------------------------------------------\nLanguage                     files          blank        comment           code\n-------------------------------------------------------------------------------\nBourne Shell                     1             51             52            392\n-------------------------------------------------------------------------------\n</code></pre>"},{"location":"examples/raw.githubusercontent.com.fb/#code","title":"Code","text":"<pre><code>#!/usr/bin/env bash\n\n{ # this ensures the entire script is downloaded #\n\nnvm_has() {\n  type \"$1\" &gt; /dev/null 2&gt;&amp;1\n}\n\nnvm_echo() {\n  command printf %s\\\\n \"$*\" 2&gt;/dev/null\n}\n\nif [ -z \"${BASH_VERSION}\" ] || [ -n \"${ZSH_VERSION}\" ]; then\n  # shellcheck disable=SC2016\n  nvm_echo &gt;&amp;2 'Error: the install instructions explicitly say to pipe the install script to `bash`; please \nfollow them'\n  exit 1\nfi\n\nnvm_grep() {\n  GREP_OPTIONS='' command grep \"$@\"\n}\n\nnvm_default_install_dir() {\n  [ -z \"${XDG_CONFIG_HOME-}\" ] &amp;&amp; printf %s \"${HOME}/.nvm\" || printf %s \"${XDG_CONFIG_HOME}/nvm\"\n}\n\nnvm_install_dir() {\n  if [ -n \"$NVM_DIR\" ]; then\n    printf %s \"${NVM_DIR}\"\n  else\n    nvm_default_install_dir\n  fi\n}\n\nnvm_latest_version() {\n  nvm_echo \"v0.40.1\"\n}\n\nnvm_profile_is_bash_or_zsh() {\n  local TEST_PROFILE\n  TEST_PROFILE=\"${1-}\"\n  case \"${TEST_PROFILE-}\" in\n    *\"/.bashrc\" | *\"/.bash_profile\" | *\"/.zshrc\" | *\"/.zprofile\")\n      return\n    ;;\n    *)\n      return 1\n    ;;\n  esac\n}\n\n#\n# Outputs the location to NVM depending on:\n# * The availability of $NVM_SOURCE\n# * The presence of $NVM_INSTALL_GITHUB_REPO\n# * The method used (\"script\" or \"git\" in the script, defaults to \"git\")\n# NVM_SOURCE always takes precedence unless the method is \"script-nvm-exec\"\n#\nnvm_source() {\n  local NVM_GITHUB_REPO\n  NVM_GITHUB_REPO=\"${NVM_INSTALL_GITHUB_REPO:-nvm-sh/nvm}\"\n  if [ \"${NVM_GITHUB_REPO}\" != 'nvm-sh/nvm' ]; then\n    { nvm_echo &gt;&amp;2 \"$(cat)\" ; } &lt;&lt; EOF\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n@    WARNING: REMOTE REPO IDENTIFICATION HAS CHANGED!     @\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\nIT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!\n\nThe default repository for this install is \\`nvm-sh/nvm\\`,\nbut the environment variables \\`\\$NVM_INSTALL_GITHUB_REPO\\` is\ncurrently set to \\`${NVM_GITHUB_REPO}\\`.\n\nIf this is not intentional, interrupt this installation and\nverify your environment variables.\nEOF\n  fi\n  local NVM_VERSION\n  NVM_VERSION=\"${NVM_INSTALL_VERSION:-$(nvm_latest_version)}\"\n  local NVM_METHOD\n  NVM_METHOD=\"$1\"\n  local NVM_SOURCE_URL\n  NVM_SOURCE_URL=\"$NVM_SOURCE\"\n  if [ \"_$NVM_METHOD\" = \"_script-nvm-exec\" ]; then\n    NVM_SOURCE_URL=\"https://raw.githubusercontent.com/${NVM_GITHUB_REPO}/${NVM_VERSION}/nvm-exec\"\n  elif [ \"_$NVM_METHOD\" = \"_script-nvm-bash-completion\" ]; then\n    NVM_SOURCE_URL=\"https://raw.githubusercontent.com/${NVM_GITHUB_REPO}/${NVM_VERSION}/bash_completion\"\n  elif [ -z \"$NVM_SOURCE_URL\" ]; then\n    if [ \"_$NVM_METHOD\" = \"_script\" ]; then\n      NVM_SOURCE_URL=\"https://raw.githubusercontent.com/${NVM_GITHUB_REPO}/${NVM_VERSION}/nvm.sh\"\n    elif [ \"_$NVM_METHOD\" = \"_git\" ] || [ -z \"$NVM_METHOD\" ]; then\n      NVM_SOURCE_URL=\"https://github.com/${NVM_GITHUB_REPO}.git\"\n    else\n      nvm_echo &gt;&amp;2 \"Unexpected value \\\"$NVM_METHOD\\\" for \\$NVM_METHOD\"\n      return 1\n    fi\n  fi\n  nvm_echo \"$NVM_SOURCE_URL\"\n}\n\n#\n# Node.js version to install\n#\nnvm_node_version() {\n  nvm_echo \"$NODE_VERSION\"\n}\n\nnvm_download() {\n  if nvm_has \"curl\"; then\n    curl --fail --compressed -q \"$@\"\n  elif nvm_has \"wget\"; then\n    # Emulate curl with wget\n    ARGS=$(nvm_echo \"$@\" | command sed -e 's/--progress-bar /--progress=bar /' \\\n                            -e 's/--compressed //' \\\n                            -e 's/--fail //' \\\n                            -e 's/-L //' \\\n                            -e 's/-I /--server-response /' \\\n                            -e 's/-s /-q /' \\\n                            -e 's/-sS /-nv /' \\\n                            -e 's/-o /-O /' \\\n                            -e 's/-C - /-c /')\n    # shellcheck disable=SC2086\n    eval wget $ARGS\n  fi\n}\n\ninstall_nvm_from_git() {\n  local INSTALL_DIR\n  INSTALL_DIR=\"$(nvm_install_dir)\"\n  local NVM_VERSION\n  NVM_VERSION=\"${NVM_INSTALL_VERSION:-$(nvm_latest_version)}\"\n  if [ -n \"${NVM_INSTALL_VERSION:-}\" ]; then\n    # Check if version is an existing ref\n    if command git ls-remote \"$(nvm_source \"git\")\" \"$NVM_VERSION\" | nvm_grep -q \"$NVM_VERSION\" ; then\n      :\n    # Check if version is an existing changeset\n    elif ! nvm_download -o /dev/null \"$(nvm_source \"script-nvm-exec\")\"; then\n      nvm_echo &gt;&amp;2 \"Failed to find '$NVM_VERSION' version.\"\n      exit 1\n    fi\n  fi\n\n  local fetch_error\n  if [ -d \"$INSTALL_DIR/.git\" ]; then\n    # Updating repo\n    nvm_echo \"=&gt; nvm is already installed in $INSTALL_DIR, trying to update using git\"\n    command printf '\\r=&gt; '\n    fetch_error=\"Failed to update nvm with $NVM_VERSION, run 'git fetch' in $INSTALL_DIR yourself.\"\n  else\n    fetch_error=\"Failed to fetch origin with $NVM_VERSION. Please report this!\"\n    nvm_echo \"=&gt; Downloading nvm from git to '$INSTALL_DIR'\"\n    command printf '\\r=&gt; '\n    mkdir -p \"${INSTALL_DIR}\"\n    if [ \"$(ls -A \"${INSTALL_DIR}\")\" ]; then\n      # Initializing repo\n      command git init \"${INSTALL_DIR}\" || {\n        nvm_echo &gt;&amp;2 'Failed to initialize nvm repo. Please report this!'\n        exit 2\n      }\n      command git --git-dir=\"${INSTALL_DIR}/.git\" remote add origin \"$(nvm_source)\" 2&gt; /dev/null \\\n        || command git --git-dir=\"${INSTALL_DIR}/.git\" remote set-url origin \"$(nvm_source)\" || {\n        nvm_echo &gt;&amp;2 'Failed to add remote \"origin\" (or set the URL). Please report this!'\n        exit 2\n      }\n    else\n      # Cloning repo\n      command git clone \"$(nvm_source)\" --depth=1 \"${INSTALL_DIR}\" || {\n        nvm_echo &gt;&amp;2 'Failed to clone nvm repo. Please report this!'\n        exit 2\n      }\n    fi\n  fi\n  # Try to fetch tag\n  if command git --git-dir=\"$INSTALL_DIR\"/.git --work-tree=\"$INSTALL_DIR\" fetch origin tag \"$NVM_VERSION\" \n--depth=1 2&gt;/dev/null; then\n    :\n  # Fetch given version\n  elif ! command git --git-dir=\"$INSTALL_DIR\"/.git --work-tree=\"$INSTALL_DIR\" fetch origin \"$NVM_VERSION\" \n--depth=1; then\n    nvm_echo &gt;&amp;2 \"$fetch_error\"\n    exit 1\n  fi\n  command git -c advice.detachedHead=false --git-dir=\"$INSTALL_DIR\"/.git --work-tree=\"$INSTALL_DIR\" checkout \n-f --quiet FETCH_HEAD || {\n    nvm_echo &gt;&amp;2 \"Failed to checkout the given version $NVM_VERSION. Please report this!\"\n    exit 2\n  }\n  if [ -n \"$(command git --git-dir=\"$INSTALL_DIR\"/.git --work-tree=\"$INSTALL_DIR\" show-ref \nrefs/heads/master)\" ]; then\n    if command git --no-pager --git-dir=\"$INSTALL_DIR\"/.git --work-tree=\"$INSTALL_DIR\" branch --quiet \n2&gt;/dev/null; then\n      command git --no-pager --git-dir=\"$INSTALL_DIR\"/.git --work-tree=\"$INSTALL_DIR\" branch --quiet -D \nmaster &gt;/dev/null 2&gt;&amp;1\n    else\n      nvm_echo &gt;&amp;2 \"Your version of git is out of date. Please update it!\"\n      command git --no-pager --git-dir=\"$INSTALL_DIR\"/.git --work-tree=\"$INSTALL_DIR\" branch -D master \n&gt;/dev/null 2&gt;&amp;1\n    fi\n  fi\n\n  nvm_echo \"=&gt; Compressing and cleaning up git repository\"\n  if ! command git --git-dir=\"$INSTALL_DIR\"/.git --work-tree=\"$INSTALL_DIR\" reflog expire --expire=now --all; \nthen\n    nvm_echo &gt;&amp;2 \"Your version of git is out of date. Please update it!\"\n  fi\n  if ! command git --git-dir=\"$INSTALL_DIR\"/.git --work-tree=\"$INSTALL_DIR\" gc --auto --aggressive \n--prune=now ; then\n    nvm_echo &gt;&amp;2 \"Your version of git is out of date. Please update it!\"\n  fi\n  return\n}\n\n#\n# Automatically install Node.js\n#\nnvm_install_node() {\n  local NODE_VERSION_LOCAL\n  NODE_VERSION_LOCAL=\"$(nvm_node_version)\"\n\n  if [ -z \"$NODE_VERSION_LOCAL\" ]; then\n    return 0\n  fi\n\n  nvm_echo \"=&gt; Installing Node.js version $NODE_VERSION_LOCAL\"\n  nvm install \"$NODE_VERSION_LOCAL\"\n  local CURRENT_NVM_NODE\n\n  CURRENT_NVM_NODE=\"$(nvm_version current)\"\n  if [ \"$(nvm_version \"$NODE_VERSION_LOCAL\")\" == \"$CURRENT_NVM_NODE\" ]; then\n    nvm_echo \"=&gt; Node.js version $NODE_VERSION_LOCAL has been successfully installed\"\n  else\n    nvm_echo &gt;&amp;2 \"Failed to install Node.js $NODE_VERSION_LOCAL\"\n  fi\n}\n\ninstall_nvm_as_script() {\n  local INSTALL_DIR\n  INSTALL_DIR=\"$(nvm_install_dir)\"\n  local NVM_SOURCE_LOCAL\n  NVM_SOURCE_LOCAL=\"$(nvm_source script)\"\n  local NVM_EXEC_SOURCE\n  NVM_EXEC_SOURCE=\"$(nvm_source script-nvm-exec)\"\n  local NVM_BASH_COMPLETION_SOURCE\n  NVM_BASH_COMPLETION_SOURCE=\"$(nvm_source script-nvm-bash-completion)\"\n\n  # Downloading to $INSTALL_DIR\n  mkdir -p \"$INSTALL_DIR\"\n  if [ -f \"$INSTALL_DIR/nvm.sh\" ]; then\n    nvm_echo \"=&gt; nvm is already installed in $INSTALL_DIR, trying to update the script\"\n  else\n    nvm_echo \"=&gt; Downloading nvm as script to '$INSTALL_DIR'\"\n  fi\n  nvm_download -s \"$NVM_SOURCE_LOCAL\" -o \"$INSTALL_DIR/nvm.sh\" || {\n    nvm_echo &gt;&amp;2 \"Failed to download '$NVM_SOURCE_LOCAL'\"\n    return 1\n  } &amp;\n  nvm_download -s \"$NVM_EXEC_SOURCE\" -o \"$INSTALL_DIR/nvm-exec\" || {\n    nvm_echo &gt;&amp;2 \"Failed to download '$NVM_EXEC_SOURCE'\"\n    return 2\n  } &amp;\n  nvm_download -s \"$NVM_BASH_COMPLETION_SOURCE\" -o \"$INSTALL_DIR/bash_completion\" || {\n    nvm_echo &gt;&amp;2 \"Failed to download '$NVM_BASH_COMPLETION_SOURCE'\"\n    return 2\n  } &amp;\n  for job in $(jobs -p | command sort)\n  do\n    wait \"$job\" || return $?\n  done\n  chmod a+x \"$INSTALL_DIR/nvm-exec\" || {\n    nvm_echo &gt;&amp;2 \"Failed to mark '$INSTALL_DIR/nvm-exec' as executable\"\n    return 3\n  }\n}\n\nnvm_try_profile() {\n  if [ -z \"${1-}\" ] || [ ! -f \"${1}\" ]; then\n    return 1\n  fi\n  nvm_echo \"${1}\"\n}\n\n#\n# Detect profile file if not specified as environment variable\n# (eg: PROFILE=~/.myprofile)\n# The echo'ed path is guaranteed to be an existing file\n# Otherwise, an empty string is returned\n#\nnvm_detect_profile() {\n  if [ \"${PROFILE-}\" = '/dev/null' ]; then\n    # the user has specifically requested NOT to have nvm touch their profile\n    return\n  fi\n\n  if [ -n \"${PROFILE}\" ] &amp;&amp; [ -f \"${PROFILE}\" ]; then\n    nvm_echo \"${PROFILE}\"\n    return\n  fi\n\n  local DETECTED_PROFILE\n  DETECTED_PROFILE=''\n\n  if [ \"${SHELL#*bash}\" != \"$SHELL\" ]; then\n    if [ -f \"$HOME/.bashrc\" ]; then\n      DETECTED_PROFILE=\"$HOME/.bashrc\"\n    elif [ -f \"$HOME/.bash_profile\" ]; then\n      DETECTED_PROFILE=\"$HOME/.bash_profile\"\n    fi\n  elif [ \"${SHELL#*zsh}\" != \"$SHELL\" ]; then\n    if [ -f \"$HOME/.zshrc\" ]; then\n      DETECTED_PROFILE=\"$HOME/.zshrc\"\n    elif [ -f \"$HOME/.zprofile\" ]; then\n      DETECTED_PROFILE=\"$HOME/.zprofile\"\n    fi\n  fi\n\n  if [ -z \"$DETECTED_PROFILE\" ]; then\n    for EACH_PROFILE in \".profile\" \".bashrc\" \".bash_profile\" \".zprofile\" \".zshrc\"\n    do\n      if DETECTED_PROFILE=\"$(nvm_try_profile \"${HOME}/${EACH_PROFILE}\")\"; then\n        break\n      fi\n    done\n  fi\n\n  if [ -n \"$DETECTED_PROFILE\" ]; then\n    nvm_echo \"$DETECTED_PROFILE\"\n  fi\n}\n\n#\n# Check whether the user has any globally-installed npm modules in their system\n# Node, and warn them if so.\n#\nnvm_check_global_modules() {\n  local NPM_COMMAND\n  NPM_COMMAND=\"$(command -v npm 2&gt;/dev/null)\" || return 0\n  [ -n \"${NVM_DIR}\" ] &amp;&amp; [ -z \"${NPM_COMMAND%%\"$NVM_DIR\"/*}\" ] &amp;&amp; return 0\n\n  local NPM_VERSION\n  NPM_VERSION=\"$(npm --version)\"\n  NPM_VERSION=\"${NPM_VERSION:--1}\"\n  [ \"${NPM_VERSION%%[!-0-9]*}\" -gt 0 ] || return 0\n\n  local NPM_GLOBAL_MODULES\n  NPM_GLOBAL_MODULES=\"$(\n    npm list -g --depth=0 |\n    command sed -e '/ npm@/d' -e '/ (empty)$/d'\n  )\"\n\n  local MODULE_COUNT\n  MODULE_COUNT=\"$(\n    command printf %s\\\\n \"$NPM_GLOBAL_MODULES\" |\n    command sed -ne '1!p' |                     # Remove the first line\n    wc -l | command tr -d ' '                   # Count entries\n  )\"\n\n  if [ \"${MODULE_COUNT}\" != '0' ]; then\n    # shellcheck disable=SC2016\n    nvm_echo '=&gt; You currently have modules installed globally with `npm`. These will no'\n    # shellcheck disable=SC2016\n    nvm_echo '=&gt; longer be linked to the active version of Node when you install a new node'\n    # shellcheck disable=SC2016\n    nvm_echo '=&gt; with `nvm`; and they may (depending on how you construct your `$PATH`)'\n    # shellcheck disable=SC2016\n    nvm_echo '=&gt; override the binaries of modules installed with `nvm`:'\n    nvm_echo\n\n    command printf %s\\\\n \"$NPM_GLOBAL_MODULES\"\n    nvm_echo '=&gt; If you wish to uninstall them at a later point (or re-install them under your'\n    # shellcheck disable=SC2016\n    nvm_echo '=&gt; `nvm` node installs), you can remove them from the system Node as follows:'\n    nvm_echo\n    nvm_echo '     $ nvm use system'\n    nvm_echo '     $ npm uninstall -g a_module'\n    nvm_echo\n  fi\n}\n\nnvm_do_install() {\n  if [ -n \"${NVM_DIR-}\" ] &amp;&amp; ! [ -d \"${NVM_DIR}\" ]; then\n    if [ -e \"${NVM_DIR}\" ]; then\n      nvm_echo &gt;&amp;2 \"File \\\"${NVM_DIR}\\\" has the same name as installation directory.\"\n      exit 1\n    fi\n\n    if [ \"${NVM_DIR}\" = \"$(nvm_default_install_dir)\" ]; then\n      mkdir \"${NVM_DIR}\"\n    else\n      nvm_echo &gt;&amp;2 \"You have \\$NVM_DIR set to \\\"${NVM_DIR}\\\", but that directory does not exist. Check your \nprofile files and environment.\"\n      exit 1\n    fi\n  fi\n  # Disable the optional which check, https://www.shellcheck.net/wiki/SC2230\n  # shellcheck disable=SC2230\n  if nvm_has xcode-select &amp;&amp; [ \"$(xcode-select -p &gt;/dev/null 2&gt;/dev/null ; echo $?)\" = '2' ] &amp;&amp; [ \"$(which \ngit)\" = '/usr/bin/git' ] &amp;&amp; [ \"$(which curl)\" = '/usr/bin/curl' ]; then\n    nvm_echo &gt;&amp;2 'You may be on a Mac, and need to install the Xcode Command Line Developer Tools.'\n    # shellcheck disable=SC2016\n    nvm_echo &gt;&amp;2 'If so, run `xcode-select --install` and try again. If not, please report this!'\n    exit 1\n  fi\n  if [ -z \"${METHOD}\" ]; then\n    # Autodetect install method\n    if nvm_has git; then\n      install_nvm_from_git\n    elif nvm_has curl || nvm_has wget; then\n      install_nvm_as_script\n    else\n      nvm_echo &gt;&amp;2 'You need git, curl, or wget to install nvm'\n      exit 1\n    fi\n  elif [ \"${METHOD}\" = 'git' ]; then\n    if ! nvm_has git; then\n      nvm_echo &gt;&amp;2 \"You need git to install nvm\"\n      exit 1\n    fi\n    install_nvm_from_git\n  elif [ \"${METHOD}\" = 'script' ]; then\n    if ! nvm_has curl &amp;&amp; ! nvm_has wget; then\n      nvm_echo &gt;&amp;2 \"You need curl or wget to install nvm\"\n      exit 1\n    fi\n    install_nvm_as_script\n  else\n    nvm_echo &gt;&amp;2 \"The environment variable \\$METHOD is set to \\\"${METHOD}\\\", which is not recognized as a \nvalid installation method.\"\n    exit 1\n  fi\n\n  nvm_echo\n\n  local NVM_PROFILE\n  NVM_PROFILE=\"$(nvm_detect_profile)\"\n  local PROFILE_INSTALL_DIR\n  PROFILE_INSTALL_DIR=\"$(nvm_install_dir | command sed \"s:^$HOME:\\$HOME:\")\"\n\n  SOURCE_STR=\"\\\\nexport NVM_DIR=\\\"${PROFILE_INSTALL_DIR}\\\"\\\\n[ -s \\\"\\$NVM_DIR/nvm.sh\\\" ] &amp;&amp; \\\\. \n\\\"\\$NVM_DIR/nvm.sh\\\"  # This loads nvm\\\\n\"\n\n  # shellcheck disable=SC2016\n  COMPLETION_STR='[ -s \"$NVM_DIR/bash_completion\" ] &amp;&amp; \\. \"$NVM_DIR/bash_completion\"  # This loads nvm \nbash_completion\\n'\n  BASH_OR_ZSH=false\n\n  if [ -z \"${NVM_PROFILE-}\" ] ; then\n    local TRIED_PROFILE\n    if [ -n \"${PROFILE}\" ]; then\n      TRIED_PROFILE=\"${NVM_PROFILE} (as defined in \\$PROFILE), \"\n    fi\n    nvm_echo \"=&gt; Profile not found. Tried ${TRIED_PROFILE-}~/.bashrc, ~/.bash_profile, ~/.zprofile, ~/.zshrc, \nand ~/.profile.\"\n    nvm_echo \"=&gt; Create one of them and run this script again\"\n    nvm_echo \"   OR\"\n    nvm_echo \"=&gt; Append the following lines to the correct file yourself:\"\n    command printf \"${SOURCE_STR}\"\n    nvm_echo\n  else\n    if nvm_profile_is_bash_or_zsh \"${NVM_PROFILE-}\"; then\n      BASH_OR_ZSH=true\n    fi\n    if ! command grep -qc '/nvm.sh' \"$NVM_PROFILE\"; then\n      nvm_echo \"=&gt; Appending nvm source string to $NVM_PROFILE\"\n      command printf \"${SOURCE_STR}\" &gt;&gt; \"$NVM_PROFILE\"\n    else\n      nvm_echo \"=&gt; nvm source string already in ${NVM_PROFILE}\"\n    fi\n    # shellcheck disable=SC2016\n    if ${BASH_OR_ZSH} &amp;&amp; ! command grep -qc '$NVM_DIR/bash_completion' \"$NVM_PROFILE\"; then\n      nvm_echo \"=&gt; Appending bash_completion source string to $NVM_PROFILE\"\n      command printf \"$COMPLETION_STR\" &gt;&gt; \"$NVM_PROFILE\"\n    else\n      nvm_echo \"=&gt; bash_completion source string already in ${NVM_PROFILE}\"\n    fi\n  fi\n  if ${BASH_OR_ZSH} &amp;&amp; [ -z \"${NVM_PROFILE-}\" ] ; then\n    nvm_echo \"=&gt; Please also append the following lines to the if you are using bash/zsh shell:\"\n    command printf \"${COMPLETION_STR}\"\n  fi\n\n  # Source nvm\n  # shellcheck source=/dev/null\n  \\. \"$(nvm_install_dir)/nvm.sh\"\n\n  nvm_check_global_modules\n\n  nvm_install_node\n\n  nvm_reset\n\n  nvm_echo \"=&gt; Close and reopen your terminal to start using nvm or run the following to use it now:\"\n  command printf \"${SOURCE_STR}\"\n  if ${BASH_OR_ZSH} ; then\n    command printf \"${COMPLETION_STR}\"\n  fi\n}\n\n#\n# Unsets the various functions defined\n# during the execution of the install script\n#\nnvm_reset() {\n  unset -f nvm_has nvm_install_dir nvm_latest_version nvm_profile_is_bash_or_zsh \\\n    nvm_source nvm_node_version nvm_download install_nvm_from_git nvm_install_node \\\n    install_nvm_as_script nvm_try_profile nvm_detect_profile nvm_check_global_modules \\\n    nvm_do_install nvm_reset nvm_default_install_dir nvm_grep\n}\n\n[ \"_$NVM_ENV\" = \"_testing\" ] || nvm_do_install\n\n} # this ensures the entire script is downloaded #\n</code></pre>"},{"location":"examples/sdk.cloud.google.com.5a/","title":"sdk.cloud.google.com","text":""},{"location":"examples/sdk.cloud.google.com.5a/#description","title":"Description","text":"<ul> <li>run <code>curl -s https://sdk.cloud.google.com | bash</code> to install Google Cloud SDK</li> <li>cf https://cloud.google.com/sdk/docs/install-sdk </li> </ul>"},{"location":"examples/sdk.cloud.google.com.5a/#stats","title":"Stats","text":"<pre><code>-------------------------------------------------------------------------------\nLanguage                     files          blank        comment           code\n-------------------------------------------------------------------------------\nBourne Shell                     1              5              0             12\n-------------------------------------------------------------------------------\n</code></pre>"},{"location":"examples/sdk.cloud.google.com.5a/#code","title":"Code","text":"<pre><code>#!/bin/bash\n\nURL=https://dl.google.com/dl/cloudsdk/channels/rapid/install_google_cloud_sdk.bash\n\nfunction download {\n  scratch=\"$(mktemp -d -t tmp.XXXXXXXXXX)\" || exit\n  script_file=\"$scratch/install_google_cloud_sdk.bash\"\n\n  echo \"Downloading Google Cloud SDK install script: $URL\"\n  curl -# \"$URL\" &gt; \"$script_file\" || exit\n  chmod 775 \"$script_file\"\n\n  echo \"Running install script from: $script_file\"\n  \"$script_file\" \"$@\"\n}\n\ndownload \"$@\"\n</code></pre>"},{"location":"blog/archive/2026/","title":"2026","text":""},{"location":"blog/category/script/","title":"script","text":""},{"location":"blog/category/frankenphpdev/","title":"frankenphp.dev","text":""},{"location":"blog/category/getdockercom/","title":"get.docker.com","text":""},{"location":"blog/category/laravelbuild/","title":"laravel.build","text":""},{"location":"blog/category/phpnew/","title":"php.new","text":""},{"location":"blog/category/rawgithubusercontentcom/","title":"raw.githubusercontent.com","text":""}]}